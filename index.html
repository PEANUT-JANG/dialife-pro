<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DiaLife Pro - 통합 당뇨 관리</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    const FOOD_DATABASE = {
      '밥': { carbs: 23, category: '주식' },
      '사과': { carbs: 14, category: '과일' },
      '라면': { carbs: 55, category: '면류' },
      '초콜릿': { carbs: 57, category: '간식' }
    };

    const App = () => {
      const [records, setRecords] = useState(() => {
        const saved = localStorage.getItem('glucose_records');
        return saved ? JSON.parse(saved) : [];
      });

      const [newRecord, setNewRecord] = useState({
        glucose: '', food: '', amount: '', insulin: '', timestamp: new Date().toISOString()
      });

      const [editingId, setEditingId] = useState(null);
      const [editData, setEditData] = useState({ glucose: '', food: '', amount: '', insulin: '' });

      const calculateCarbs = (food, amount) => {
        if (!FOOD_DATABASE[food]) return 0;
        return Math.round((FOOD_DATABASE[food].carbs * parseFloat(amount || 0)) / 100);
      };

      const handleSave = () => {
        const record = {
          ...newRecord,
          id: Date.now(),
          carbs: calculateCarbs(newRecord.food, newRecord.amount)
        };
        const updated = [...records, record];
        setRecords(updated);
        localStorage.setItem('glucose_records', JSON.stringify(updated));
        setNewRecord({ glucose: '', food: '', amount: '', insulin: '', timestamp: new Date().toISOString() });
      };

      const handleDelete = (id) => {
        const updated = records.filter(r => r.id !== id);
        setRecords(updated);
        localStorage.setItem('glucose_records', JSON.stringify(updated));
      };

      const startEdit = (record) => {
        setEditingId(record.id);
        setEditData({
          glucose: record.glucose,
          food: record.food,
          amount: record.amount,
          insulin: record.insulin
        });
      };

      const confirmEdit = (id) => {
        const updated = records.map(r =>
          r.id === id ? {
            ...r,
            ...editData,
            carbs: calculateCarbs(editData.food, editData.amount)
          } : r
        );
        setRecords(updated);
        localStorage.setItem('glucose_records', JSON.stringify(updated));
        setEditingId(null);
        setEditData({ glucose: '', food: '', amount: '', insulin: '' });
      };

      return (
        <div className="max-w-3xl mx-auto py-10 px-4">
          <h1 className="text-2xl font-bold mb-6">DiaLife Pro 🍚</h1>

          <div className="grid grid-cols-1 md:grid-cols-2 gap-4 bg-white shadow p-6 rounded-xl">
            <input type="number" className="border p-2 rounded" placeholder="혈당 (mg/dL)"
              value={newRecord.glucose}
              onChange={(e) => setNewRecord({ ...newRecord, glucose: e.target.value })} />
            <input type="text" className="border p-2 rounded" placeholder="음식 이름"
              value={newRecord.food}
              onChange={(e) => setNewRecord({ ...newRecord, food: e.target.value })} />
            <input type="number" className="border p-2 rounded" placeholder="섭취량 (g)"
              value={newRecord.amount}
              onChange={(e) => setNewRecord({ ...newRecord, amount: e.target.value })} />
            <input type="number" className="border p-2 rounded" placeholder="인슐린 용량"
              value={newRecord.insulin}
              onChange={(e) => setNewRecord({ ...newRecord, insulin: e.target.value })} />
            <button onClick={handleSave} className="bg-blue-500 text-white rounded py-2 px-4 col-span-full hover:bg-blue-600">
              기록 저장하기
            </button>
          </div>

          <div className="mt-10">
            <h2 className="text-xl font-semibold mb-4">기록 목록</h2>
            {records.length === 0 && <p className="text-gray-500">기록이 없습니다.</p>}
            <ul className="space-y-4">
              {records.map(record => (
                <li key={record.id} className="bg-gray-50 border rounded-xl p-4">
                  {editingId === record.id ? (
                    <div className="grid md:grid-cols-2 gap-4">
                      <input type="number" value={editData.glucose} onChange={(e) => setEditData({ ...editData, glucose: e.target.value })} className="border p-2 rounded" />
                      <input type="text" value={editData.food} onChange={(e) => setEditData({ ...editData, food: e.target.value })} className="border p-2 rounded" />
                      <input type="number" value={editData.amount} onChange={(e) => setEditData({ ...editData, amount: e.target.value })} className="border p-2 rounded" />
                      <input type="number" value={editData.insulin} onChange={(e) => setEditData({ ...editData, insulin: e.target.value })} className="border p-2 rounded" />
                      <div className="col-span-full flex gap-2">
                        <button onClick={() => confirmEdit(record.id)} className="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">저장</button>
                        <button onClick={() => setEditingId(null)} className="bg-gray-300 px-4 py-2 rounded hover:bg-gray-400">취소</button>
                      </div>
                    </div>
                  ) : (
                    <div className="flex justify-between items-center">
                      <div>
                        <p><strong>혈당:</strong> {record.glucose} mg/dL</p>
                        <p><strong>음식:</strong> {record.food} ({record.amount}g)</p>
                        <p><strong>탄수화물:</strong> {record.carbs}g</p>
                        <p><strong>인슐린:</strong> {record.insulin} 단위</p>
                        <p className="text-sm text-gray-400">{new Date(record.timestamp).toLocaleString()}</p>
                      </div>
                      <div className="flex gap-2">
                        <button onClick={() => startEdit(record)} className="text-blue-600 hover:underline">수정</button>
                        <button onClick={() => handleDelete(record.id)} className="text-red-600 hover:underline">삭제</button>
                      </div>
                    </div>
                  )}
                </li>
              ))}
            </ul>
          </div>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
