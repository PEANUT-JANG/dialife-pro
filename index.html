<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DiaLife Pro - í†µí•© ë‹¹ë‡¨ ê´€ë¦¬</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    const FOOD_DATABASE = {
      'ë°¥': { carbs: 23, category: 'ì£¼ì‹' },
      'ì‚¬ê³¼': { carbs: 14, category: 'ê³¼ì¼' },
      'ë¼ë©´': { carbs: 55, category: 'ë©´ë¥˜' },
      'ì´ˆì½œë¦¿': { carbs: 57, category: 'ê°„ì‹' }
    };

    const App = () => {
      const [records, setRecords] = useState(() => {
        const saved = localStorage.getItem('glucose_records');
        return saved ? JSON.parse(saved) : [];
      });

      const [newRecord, setNewRecord] = useState({
        glucose: '', food: '', amount: '', insulin: '', timestamp: new Date().toISOString()
      });

      const [editingId, setEditingId] = useState(null);
      const [editData, setEditData] = useState({ glucose: '', food: '', amount: '', insulin: '' });

      const calculateCarbs = (food, amount) => {
        if (!FOOD_DATABASE[food]) return 0;
        return Math.round((FOOD_DATABASE[food].carbs * parseFloat(amount || 0)) / 100);
      };

      const handleSave = () => {
        const record = {
          ...newRecord,
          id: Date.now(),
          carbs: calculateCarbs(newRecord.food, newRecord.amount)
        };
        const updated = [...records, record];
        setRecords(updated);
        localStorage.setItem('glucose_records', JSON.stringify(updated));
        setNewRecord({ glucose: '', food: '', amount: '', insulin: '', timestamp: new Date().toISOString() });
      };

      const handleDelete = (id) => {
        const updated = records.filter(r => r.id !== id);
        setRecords(updated);
        localStorage.setItem('glucose_records', JSON.stringify(updated));
      };

      const startEdit = (record) => {
        setEditingId(record.id);
        setEditData({
          glucose: record.glucose,
          food: record.food,
          amount: record.amount,
          insulin: record.insulin
        });
      };

      const confirmEdit = (id) => {
        const updated = records.map(r =>
          r.id === id ? {
            ...r,
            ...editData,
            carbs: calculateCarbs(editData.food, editData.amount)
          } : r
        );
        setRecords(updated);
        localStorage.setItem('glucose_records', JSON.stringify(updated));
        setEditingId(null);
        setEditData({ glucose: '', food: '', amount: '', insulin: '' });
      };

      return (
        <div className="max-w-3xl mx-auto py-10 px-4">
          <h1 className="text-2xl font-bold mb-6">DiaLife Pro ğŸš</h1>

          <div className="grid grid-cols-1 md:grid-cols-2 gap-4 bg-white shadow p-6 rounded-xl">
            <input type="number" className="border p-2 rounded" placeholder="í˜ˆë‹¹ (mg/dL)"
              value={newRecord.glucose}
              onChange={(e) => setNewRecord({ ...newRecord, glucose: e.target.value })} />
            <input type="text" className="border p-2 rounded" placeholder="ìŒì‹ ì´ë¦„"
              value={newRecord.food}
              onChange={(e) => setNewRecord({ ...newRecord, food: e.target.value })} />
            <input type="number" className="border p-2 rounded" placeholder="ì„­ì·¨ëŸ‰ (g)"
              value={newRecord.amount}
              onChange={(e) => setNewRecord({ ...newRecord, amount: e.target.value })} />
            <input type="number" className="border p-2 rounded" placeholder="ì¸ìŠë¦° ìš©ëŸ‰"
              value={newRecord.insulin}
              onChange={(e) => setNewRecord({ ...newRecord, insulin: e.target.value })} />
            <button onClick={handleSave} className="bg-blue-500 text-white rounded py-2 px-4 col-span-full hover:bg-blue-600">
              ê¸°ë¡ ì €ì¥í•˜ê¸°
            </button>
          </div>

          <div className="mt-10">
            <h2 className="text-xl font-semibold mb-4">ê¸°ë¡ ëª©ë¡</h2>
            {records.length === 0 && <p className="text-gray-500">ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>}
            <ul className="space-y-4">
              {records.map(record => (
                <li key={record.id} className="bg-gray-50 border rounded-xl p-4">
                  {editingId === record.id ? (
                    <div className="grid md:grid-cols-2 gap-4">
                      <input type="number" value={editData.glucose} onChange={(e) => setEditData({ ...editData, glucose: e.target.value })} className="border p-2 rounded" />
                      <input type="text" value={editData.food} onChange={(e) => setEditData({ ...editData, food: e.target.value })} className="border p-2 rounded" />
                      <input type="number" value={editData.amount} onChange={(e) => setEditData({ ...editData, amount: e.target.value })} className="border p-2 rounded" />
                      <input type="number" value={editData.insulin} onChange={(e) => setEditData({ ...editData, insulin: e.target.value })} className="border p-2 rounded" />
                      <div className="col-span-full flex gap-2">
                        <button onClick={() => confirmEdit(record.id)} className="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">ì €ì¥</button>
                        <button onClick={() => setEditingId(null)} className="bg-gray-300 px-4 py-2 rounded hover:bg-gray-400">ì·¨ì†Œ</button>
                      </div>
                    </div>
                  ) : (
                    <div className="flex justify-between items-center">
                      <div>
                        <p><strong>í˜ˆë‹¹:</strong> {record.glucose} mg/dL</p>
                        <p><strong>ìŒì‹:</strong> {record.food} ({record.amount}g)</p>
                        <p><strong>íƒ„ìˆ˜í™”ë¬¼:</strong> {record.carbs}g</p>
                        <p><strong>ì¸ìŠë¦°:</strong> {record.insulin} ë‹¨ìœ„</p>
                        <p className="text-sm text-gray-400">{new Date(record.timestamp).toLocaleString()}</p>
                      </div>
                      <div className="flex gap-2">
                        <button onClick={() => startEdit(record)} className="text-blue-600 hover:underline">ìˆ˜ì •</button>
                        <button onClick={() => handleDelete(record.id)} className="text-red-600 hover:underline">ì‚­ì œ</button>
                      </div>
                    </div>
                  )}
                </li>
              ))}
            </ul>
          </div>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
