<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1í˜• ë‹¹ë‡¨ ê´€ë¦¬</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;

        const STORAGE_KEYS = {
            USERS: 'diabetes_app_users',
            CURRENT_USER: 'diabetes_app_current_user',
            DISCLAIMER: 'diabetes_app_disclaimer_accepted'
        };

        // ê°„ë‹¨í•œ í•´ì‹œ í•¨ìˆ˜ (ì‹¤ì œ ìš´ì˜í™˜ê²½ì—ì„œëŠ” ë” ê°•ë ¥í•œ í•´ì‹± í•„ìš”)
        const simpleHash = (str) => {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            return hash.toString(36);
        };

        function DiabetesApp() {
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [currentUser, setCurrentUser] = useState(null);
            const [showLoginModal, setShowLoginModal] = useState(true);
            const [isSignupMode, setIsSignupMode] = useState(false);
            const [loginForm, setLoginForm] = useState({ username: '', password: '' });
            const [disclaimerAccepted, setDisclaimerAccepted] = useState(false);
            const [profiles, setProfiles] = useState([]);
            const [currentProfile, setCurrentProfile] = useState(null);
            const [currentTab, setCurrentTab] = useState('dashboard');
            const [showRecordModal, setShowRecordModal] = useState(false);
            const [showExerciseModal, setShowExerciseModal] = useState(false);
            const [showCalculatorModal, setShowCalculatorModal] = useState(false);
            const [showSettingsModal, setShowSettingsModal] = useState(false);

            const [recordForm, setRecordForm] = useState({
                bloodSugar: '', insulin: '', food: '', exercise: '', note: ''
            });

            const [exerciseForm, setExerciseForm] = useState({
                type: 'í—¬ìŠ¤', intensity: 'ì¤‘ê°„', startBG: ''
            });

            const [calculatorForm, setCalculatorForm] = useState({
                currentBG: '', foodName: '', carbs: ''
            });
            const [calculatedInsulin, setCalculatedInsulin] = useState(null);

            // ì´ˆê¸° ë¡œë”© í”Œë˜ê·¸
            const isInitialLoad = useRef(true);

            // ì‚¬ìš©ì ë°ì´í„° ì €ì¥ í•¨ìˆ˜ (useCallbackìœ¼ë¡œ ìµœì í™”)
            const saveUserData = useCallback(() => {
                if (!currentUser || !currentProfile || !profiles.length || isInitialLoad.current) {
                    return;
                }
                try {
                    const userDataKey = `diabetes_data_${currentUser.username}`;
                    const userData = {
                        profiles: profiles,
                        currentProfile: currentProfile
                    };
                    localStorage.setItem(userDataKey, JSON.stringify(userData));
                } catch (error) {
                    console.error('ì €ì¥ ì˜¤ë¥˜:', error);
                }
            }, [currentUser, currentProfile, profiles]);

            // ì´ˆê¸° ë¡œë”©
            useEffect(() => {
                try {
                    // ë©´ì±… ì¡°í•­ í™•ì¸
                    const disclaimerStatus = localStorage.getItem(STORAGE_KEYS.DISCLAIMER);
                    if (disclaimerStatus === 'accepted') {
                        setDisclaimerAccepted(true);
                    }

                    // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
                    const savedUser = localStorage.getItem(STORAGE_KEYS.CURRENT_USER);
                    if (savedUser) {
                        const user = JSON.parse(savedUser);
                        setCurrentUser(user);
                        setIsLoggedIn(true);
                        setShowLoginModal(false);
                        loadUserData(user.username);
                    }
                } catch (error) {
                    console.error('ë¡œë”© ì˜¤ë¥˜:', error);
                }
            }, []);

            // ë°ì´í„° ë³€ê²½ ì‹œ ìë™ ì €ì¥ (ì´ˆê¸° ë¡œë”© ì´í›„)
            useEffect(() => {
                if (!isInitialLoad.current) {
                    saveUserData();
                }
            }, [currentProfile, profiles, saveUserData]);

            const loadUserData = (username) => {
                try {
                    const userDataKey = `diabetes_data_${username}`;
                    const savedData = localStorage.getItem(userDataKey);
                    
                    if (savedData) {
                        const userData = JSON.parse(savedData);
                        setProfiles(userData.profiles || []);
                        setCurrentProfile(userData.currentProfile || userData.profiles[0]);
                    } else {
                        // ìƒˆ ì‚¬ìš©ì ë°ì´í„° ì´ˆê¸°í™”
                        const defaultProfile = {
                            id: Date.now().toString(),
                            name: 'ë‚´ í”„ë¡œí•„',
                            createdAt: new Date().toISOString(),
                            settings: { icr: 10, isf: 50, targetBG: 120 },
                            records: [],
                            exerciseSessions: []
                        };
                        setProfiles([defaultProfile]);
                        setCurrentProfile(defaultProfile);
                        
                        // ìƒˆ ì‚¬ìš©ìëŠ” ì¦‰ì‹œ ì €ì¥
                        setTimeout(() => {
                            const userData = {
                                profiles: [defaultProfile],
                                currentProfile: defaultProfile
                            };
                            localStorage.setItem(userDataKey, JSON.stringify(userData));
                        }, 100);
                    }
                    
                    // ì´ˆê¸° ë¡œë”© ì™„ë£Œ
                    setTimeout(() => {
                        isInitialLoad.current = false;
                    }, 200);
                } catch (error) {
                    console.error('ì‚¬ìš©ì ë°ì´í„° ë¡œë”© ì˜¤ë¥˜:', error);
                }
            };

            const handleLogin = () => {
                if (!loginForm.username || !loginForm.password) {
                    alert('ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }

                if (loginForm.username.length < 3) {
                    alert('ì•„ì´ë””ëŠ” 3ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
                    return;
                }

                if (loginForm.password.length < 4) {
                    alert('ë¹„ë°€ë²ˆí˜¸ëŠ” 4ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
                    return;
                }

                try {
                    const usersData = localStorage.getItem(STORAGE_KEYS.USERS);
                    const users = usersData ? JSON.parse(usersData) : {};

                    if (isSignupMode) {
                        // íšŒì›ê°€ì…
                        if (users[loginForm.username]) {
                            alert('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì•„ì´ë””ì…ë‹ˆë‹¤.');
                            return;
                        }
                        users[loginForm.username] = {
                            username: loginForm.username,
                            passwordHash: simpleHash(loginForm.password),
                            createdAt: new Date().toISOString()
                        };
                        localStorage.setItem(STORAGE_KEYS.USERS, JSON.stringify(users));
                        alert('íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
                        setIsSignupMode(false);
                        setLoginForm({ username: loginForm.username, password: '' });
                    } else {
                        // ë¡œê·¸ì¸
                        const user = users[loginForm.username];
                        if (!user || user.passwordHash !== simpleHash(loginForm.password)) {
                            alert('ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                            return;
                        }
                        
                        setCurrentUser(user);
                        setIsLoggedIn(true);
                        setShowLoginModal(false);
                        localStorage.setItem(STORAGE_KEYS.CURRENT_USER, JSON.stringify(user));
                        isInitialLoad.current = true; // ë¡œê·¸ì¸ ì‹œ ì´ˆê¸° ë¡œë”© í”Œë˜ê·¸ ë¦¬ì…‹
                        loadUserData(user.username);
                    }
                } catch (error) {
                    console.error('ë¡œê·¸ì¸ ì˜¤ë¥˜:', error);
                    alert('ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            };

            const handleLogout = () => {
                if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    // í˜„ì¬ ë°ì´í„° ìµœì¢… ì €ì¥
                    if (currentUser && currentProfile && profiles.length > 0) {
                        const userDataKey = `diabetes_data_${currentUser.username}`;
                        const userData = {
                            profiles: profiles,
                            currentProfile: currentProfile
                        };
                        localStorage.setItem(userDataKey, JSON.stringify(userData));
                    }
                    
                    // ìƒíƒœ ì´ˆê¸°í™”
                    localStorage.removeItem(STORAGE_KEYS.CURRENT_USER);
                    setIsLoggedIn(false);
                    setCurrentUser(null);
                    setProfiles([]);
                    setCurrentProfile(null);
                    setShowLoginModal(true);
                    setLoginForm({ username: '', password: '' });
                    setCurrentTab('dashboard');
                    isInitialLoad.current = true;
                }
            };

            const addRecord = () => {
                if (!recordForm.bloodSugar && !recordForm.insulin && !recordForm.food) {
                    alert('ìµœì†Œ í•˜ë‚˜ì˜ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
                const newRecord = {
                    id: Date.now(),
                    timestamp: new Date().toISOString(),
                    ...recordForm
                };
                setCurrentProfile({
                    ...currentProfile,
                    records: [...(currentProfile.records || []), newRecord]
                });
                setRecordForm({ bloodSugar: '', insulin: '', food: '', exercise: '', note: '' });
                setShowRecordModal(false);
            };

            const deleteRecord = (id) => {
                if (confirm('ì´ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    setCurrentProfile({
                        ...currentProfile,
                        records: currentProfile.records.filter(r => r.id !== id)
                    });
                }
            };

            const addExerciseSession = () => {
                if (!exerciseForm.startBG) {
                    alert('ì‹œì‘ í˜ˆë‹¹ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
                const newSession = {
                    id: Date.now(),
                    type: exerciseForm.type,
                    startTime: new Date().toISOString(),
                    endTime: '',
                    intensity: exerciseForm.intensity,
                    bgRecords: [{
                        timestamp: new Date().toISOString(),
                        value: exerciseForm.startBG,
                        label: 'ìš´ë™ ì‹œì‘'
                    }],
                    note: '',
                    status: 'active'
                };
                setCurrentProfile({
                    ...currentProfile,
                    exerciseSessions: [...(currentProfile.exerciseSessions || []), newSession]
                });
                setExerciseForm({ type: 'í—¬ìŠ¤', intensity: 'ì¤‘ê°„', startBG: '' });
                setShowExerciseModal(false);
            };

            const deleteExerciseSession = (id) => {
                if (confirm('ì´ ìš´ë™ ì„¸ì…˜ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    setCurrentProfile({
                        ...currentProfile,
                        exerciseSessions: currentProfile.exerciseSessions.filter(s => s.id !== id)
                    });
                }
            };

            const calculateInsulin = () => {
                if (!calculatorForm.currentBG || !calculatorForm.carbs) {
                    alert('í˜„ì¬ í˜ˆë‹¹ê³¼ íƒ„ìˆ˜í™”ë¬¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
                const bg = parseFloat(calculatorForm.currentBG);
                const carbs = parseFloat(calculatorForm.carbs);
                const settings = currentProfile.settings;

                const carbInsulin = carbs / settings.icr;
                const correctionInsulin = (bg - settings.targetBG) / settings.isf;
                const totalInsulin = Math.max(0, carbInsulin + correctionInsulin);

                setCalculatedInsulin({
                    carb: carbInsulin.toFixed(1),
                    correction: correctionInsulin.toFixed(1),
                    total: totalInsulin.toFixed(1),
                    rounded: Math.round(totalInsulin * 2) / 2
                });
            };

            const saveCalculatorAsRecord = () => {
                const newRecord = {
                    id: Date.now(),
                    timestamp: new Date().toISOString(),
                    bloodSugar: calculatorForm.currentBG,
                    insulin: calculatedInsulin.rounded.toString(),
                    food: calculatorForm.foodName ? `${calculatorForm.foodName} (íƒ„${calculatorForm.carbs}g)` : `íƒ„ìˆ˜í™”ë¬¼ ${calculatorForm.carbs}g`,
                    exercise: '',
                    note: 'ì¸ìŠë¦° ê³„ì‚°ê¸°ë¡œ ì¶”ê°€ë¨'
                };
                setCurrentProfile({
                    ...currentProfile,
                    records: [...(currentProfile.records || []), newRecord]
                });
                setShowCalculatorModal(false);
                setCalculatorForm({ currentBG: '', foodName: '', carbs: '' });
                setCalculatedInsulin(null);
            };

            const exportData = () => {
                const dataStr = JSON.stringify(currentProfile, null, 2);
                const blob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `diabetes-${currentProfile.name}-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                URL.revokeObjectURL(url);
            };

            if (!disclaimerAccepted) {
                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                        <div className="bg-white rounded-lg max-w-2xl w-full p-6">
                            <h2 className="text-xl font-bold text-red-600 mb-4">âš ï¸ ì˜ë£Œ ë©´ì±…ì¡°í•­</h2>
                            <ul className="list-disc pl-5 space-y-2 text-sm mb-6">
                                <li>ë³¸ ì•±ì€ 1í˜• ë‹¹ë‡¨ë³‘ ê´€ë¦¬ë¥¼ ë•ê¸° ìœ„í•œ <strong>ë³´ì¡° ë„êµ¬</strong>ì…ë‹ˆë‹¤.</li>
                                <li>ì¸ìŠë¦° íˆ¬ì—¬ëŸ‰ ê³„ì‚°ì€ <strong>ì°¸ê³ ìš©</strong>ì´ë©°, ì‹¤ì œ íˆ¬ì—¬ ì „ ë°˜ë“œì‹œ ì£¼ì¹˜ì˜ì™€ ìƒë‹´í•˜ì„¸ìš”.</li>
                                <li>ì‘ê¸‰ ìƒí™© ì‹œ ì¦‰ì‹œ ì˜ë£Œê¸°ê´€ì„ ë°©ë¬¸í•˜ì„¸ìš”.</li>
                                <li>ëŒ€í•œë‹¹ë‡¨ë³‘í•™íšŒ ë° ë³´ê±´ë³µì§€ë¶€ ì§€ì¹¨ì„ ì°¸ê³ í•˜ì—¬ ì œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.</li>
                            </ul>
                            <button
                                onClick={() => {
                                    setDisclaimerAccepted(true);
                                    localStorage.setItem(STORAGE_KEYS.DISCLAIMER, 'accepted');
                                }}
                                className="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700"
                            >
                                ë™ì˜í•˜ê³  ì‹œì‘í•˜ê¸°
                            </button>
                        </div>
                    </div>
                );
            }

            if (showLoginModal || !isLoggedIn) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center p-4">
                        <div className="bg-white rounded-lg max-w-md w-full p-8 shadow-2xl">
                            <div className="text-center mb-8">
                                <h1 className="text-3xl font-bold text-gray-800 mb-2">ğŸ©º 1í˜• ë‹¹ë‡¨ ê´€ë¦¬</h1>
                                <p className="text-gray-600">{isSignupMode ? 'ìƒˆ ê³„ì •ì„ ë§Œë“¤ì–´ì£¼ì„¸ìš”' : 'ë¡œê·¸ì¸í•˜ì—¬ ì‹œì‘í•˜ì„¸ìš”'}</p>
                            </div>
                            
                            <div className="space-y-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">ì•„ì´ë””</label>
                                    <input
                                        type="text"
                                        value={loginForm.username}
                                        onChange={(e) => setLoginForm({...loginForm, username: e.target.value})}
                                        onKeyDown={(e) => e.key === 'Enter' && handleLogin()}
                                        className="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš” (3ì ì´ìƒ)"
                                        autoComplete="username"
                                    />
                                </div>
                                
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">ë¹„ë°€ë²ˆí˜¸</label>
                                    <input
                                        type="password"
                                        value={loginForm.password}
                                        onChange={(e) => setLoginForm({...loginForm, password: e.target.value})}
                                        onKeyDown={(e) => e.key === 'Enter' && handleLogin()}
                                        className="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” (4ì ì´ìƒ)"
                                        autoComplete={isSignupMode ? "new-password" : "current-password"}
                                    />
                                </div>
                                
                                <button
                                    onClick={handleLogin}
                                    className="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition"
                                >
                                    {isSignupMode ? 'íšŒì›ê°€ì…' : 'ë¡œê·¸ì¸'}
                                </button>
                                
                                <div className="text-center">
                                    <button
                                        onClick={() => {
                                            setIsSignupMode(!isSignupMode);
                                            setLoginForm({ username: '', password: '' });
                                        }}
                                        className="text-blue-600 hover:text-blue-700 text-sm font-medium"
                                    >
                                        {isSignupMode ? 'ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? ë¡œê·¸ì¸' : 'ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”? íšŒì›ê°€ì…'}
                                    </button>
                                </div>
                            </div>
                            
                            <div className="mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                                <p className="text-xs text-yellow-800">
                                    <strong>âš ï¸ ì£¼ì˜:</strong> ì´ ì•±ì€ ë¸Œë¼ìš°ì € ë¡œì»¬ ì €ì¥ì†Œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. 
                                    ë¸Œë¼ìš°ì € ë°ì´í„°ë¥¼ ì‚­ì œí•˜ë©´ ê¸°ë¡ì´ ì†ì‹¤ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                                </p>
                            </div>
                        </div>
                    </div>
                );
            }

            if (!currentProfile) {
                return <div className="flex items-center justify-center h-screen">ë¡œë”©ì¤‘...</div>;
            }

            const records = currentProfile.records || [];
            const exerciseSessions = currentProfile.exerciseSessions || [];
            const settings = currentProfile.settings || { icr: 10, isf: 50, targetBG: 120 };

            const latestBG = records.filter(r => r.bloodSugar).sort((a, b) => 
                new Date(b.timestamp) - new Date(a.timestamp)
            )[0];

            return (
                <div className="min-h-screen bg-gray-50">
                    <header className="bg-blue-600 text-white p-4 shadow-lg">
                        <div className="max-w-6xl mx-auto flex items-center justify-between">
                            <div>
                                <h1 className="text-2xl font-bold">1í˜• ë‹¹ë‡¨ ê´€ë¦¬</h1>
                                <p className="text-sm">ğŸ‘¤ {currentUser?.username} | í”„ë¡œí•„: {currentProfile.name}</p>
                            </div>
                            <div className="flex gap-2">
                                <button onClick={() => setShowSettingsModal(true)} className="p-2 hover:bg-blue-700 rounded" title="ì„¤ì •">âš™ï¸</button>
                                <button onClick={exportData} className="p-2 hover:bg-blue-700 rounded" title="ë‚´ë³´ë‚´ê¸°">â¬‡ï¸</button>
                                <button onClick={handleLogout} className="px-3 py-2 bg-blue-700 hover:bg-blue-800 rounded font-medium text-sm" title="ë¡œê·¸ì•„ì›ƒ">ğŸšª ë¡œê·¸ì•„ì›ƒ</button>
                            </div>
                        </div>
                    </header>

                    <div className="bg-white shadow">
                        <div className="max-w-6xl mx-auto flex">
                            <button onClick={() => setCurrentTab('dashboard')} className={`flex-1 py-3 font-medium ${currentTab === 'dashboard' ? 'border-b-2 border-blue-600 text-blue-600' : 'text-gray-600'}`}>ëŒ€ì‹œë³´ë“œ</button>
                            <button onClick={() => setCurrentTab('records')} className={`flex-1 py-3 font-medium ${currentTab === 'records' ? 'border-b-2 border-blue-600 text-blue-600' : 'text-gray-600'}`}>ê¸°ë¡ ê´€ë¦¬</button>
                            <button onClick={() => setCurrentTab('exercise')} className={`flex-1 py-3 font-medium ${currentTab === 'exercise' ? 'border-b-2 border-blue-600 text-blue-600' : 'text-gray-600'}`}>ìš´ë™ ì¶”ì </button>
                        </div>
                    </div>

                    <main className="max-w-6xl mx-auto p-4 space-y-4">
                        {currentTab === 'dashboard' && (
                            <>
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div className="bg-white rounded-lg shadow p-4">
                                        <p className="text-sm text-gray-600 mb-2">ìµœê·¼ í˜ˆë‹¹</p>
                                        <p className={`text-3xl font-bold ${latestBG ? (parseFloat(latestBG.bloodSugar) < 70 ? 'text-red-600' : parseFloat(latestBG.bloodSugar) > 180 ? 'text-orange-600' : 'text-green-600') : 'text-gray-400'}`}>
                                            {latestBG ? `${latestBG.bloodSugar} mg/dL` : 'ê¸°ë¡ ì—†ìŒ'}
                                        </p>
                                    </div>
                                    <div className="bg-white rounded-lg shadow p-4">
                                        <p className="text-sm text-gray-600 mb-2">ì´ ê¸°ë¡</p>
                                        <p className="text-3xl font-bold text-blue-600">{records.length}ê±´</p>
                                    </div>
                                    <div className="bg-white rounded-lg shadow p-4">
                                        <p className="text-sm text-gray-600 mb-2">ìš´ë™ ì„¸ì…˜</p>
                                        <p className="text-3xl font-bold text-purple-600">{exerciseSessions.length}ê±´</p>
                                    </div>
                                </div>

                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <button onClick={() => setShowRecordModal(true)} className="bg-blue-600 text-white p-4 rounded-lg font-semibold hover:bg-blue-700">â• í˜ˆë‹¹ ê¸°ë¡ ì¶”ê°€</button>
                                    <button onClick={() => setShowCalculatorModal(true)} className="bg-green-600 text-white p-4 rounded-lg font-semibold hover:bg-green-700">ğŸ ì¸ìŠë¦° ê³„ì‚°ê¸°</button>
                                    <button onClick={() => setShowExerciseModal(true)} className="bg-purple-600 text-white p-4 rounded-lg font-semibold hover:bg-purple-700">ğŸ‹ï¸ ìš´ë™ ì‹œì‘</button>
                                </div>

                                <div className="bg-white rounded-lg shadow p-4">
                                    <h2 className="text-lg font-bold mb-4">ìµœê·¼ ê¸°ë¡</h2>
                                    {records.length === 0 ? (
                                        <p className="text-gray-500 text-center py-8">ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤. ì²« ê¸°ë¡ì„ ì¶”ê°€í•´ë³´ì„¸ìš”!</p>
                                    ) : (
                                        <div className="space-y-2">
                                            {records.slice(-5).reverse().map(record => (
                                                <div key={record.id} className="border rounded p-3 flex justify-between items-start">
                                                    <div className="flex-1">
                                                        <p className="text-sm text-gray-600">{new Date(record.timestamp).toLocaleString('ko-KR')}</p>
                                                        {record.bloodSugar && <p className="font-semibold">í˜ˆë‹¹: {record.bloodSugar} mg/dL</p>}
                                                        {record.insulin && <p className="text-blue-600">ì¸ìŠë¦°: {record.insulin}U</p>}
                                                        {record.food && <p className="text-sm">ğŸ½ï¸ {record.food}</p>}
                                                    </div>
                                                    <button onClick={() => deleteRecord(record.id)} className="text-red-600 hover:text-red-800">ğŸ—‘ï¸</button>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            </>
                        )}

                        {currentTab === 'records' && (
                            <div className="bg-white rounded-lg shadow p-4">
                                <h2 className="text-lg font-bold mb-4">ì „ì²´ ê¸°ë¡ ({records.length}ê±´)</h2>
                                {records.length === 0 ? (
                                    <p className="text-gray-500 text-center py-8">ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                                ) : (
                                    <div className="space-y-2 max-h-96 overflow-y-auto">
                                        {records.slice().reverse().map(record => (
                                            <div key={record.id} className="border rounded p-3 flex justify-between items-start">
                                                <div className="flex-1">
                                                    <p className="text-sm text-gray-600">{new Date(record.timestamp).toLocaleString('ko-KR')}</p>
                                                    {record.bloodSugar && <p className="font-semibold">í˜ˆë‹¹: {record.bloodSugar} mg/dL</p>}
                                                    {record.insulin && <p className="text-blue-600">ì¸ìŠë¦°: {record.insulin}U</p>}
                                                    {record.food && <p className="text-sm">ğŸ½ï¸ {record.food}</p>}
                                                    {record.exercise && <p className="text-sm">ğŸ’ª {record.exercise}</p>}
                                                    {record.note && <p className="text-xs text-gray-500 mt-1">{record.note}</p>}
                                                </div>
                                                <button onClick={() => deleteRecord(record.id)} className="text-red-600 hover:text-red-800">ğŸ—‘ï¸</button>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}

                        {currentTab === 'exercise' && (
                            <div className="bg-white rounded-lg shadow p-4">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-lg font-bold">ìš´ë™ ì„¸ì…˜ ({exerciseSessions.length}ê±´)</h2>
                                    <button onClick={() => setShowExerciseModal(true)} className="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">â• ìƒˆ ì„¸ì…˜</button>
                                </div>
                                {exerciseSessions.length === 0 ? (
                                    <p className="text-gray-500 text-center py-8">ìš´ë™ ì„¸ì…˜ì´ ì—†ìŠµë‹ˆë‹¤. ì²« ìš´ë™ì„ ì‹œì‘í•´ë³´ì„¸ìš”!</p>
                                ) : (
                                    <div className="space-y-3">
                                        {exerciseSessions.slice().reverse().map(session => (
                                            <div key={session.id} className="border rounded p-4">
                                                <div className="flex justify-between items-start">
                                                    <div className="flex-1">
                                                        <div className="flex items-center gap-2 mb-2">
                                                            <span>ğŸ‹ï¸</span>
                                                            <span className="font-semibold">{session.type}</span>
                                                            <span className="text-sm text-gray-600">({session.intensity})</span>
                                                        </div>
                                                        <p className="text-sm text-gray-600">{new Date(session.startTime).toLocaleString('ko-KR')}</p>
                                                        {session.bgRecords && session.bgRecords.length > 0 && (
                                                            <div className="mt-2 bg-purple-50 rounded p-2">
                                                                <p className="text-xs font-medium mb-1">í˜ˆë‹¹ ë³€í™”</p>
                                                                {session.bgRecords.map((bg, idx) => (
                                                                    <span key={idx} className="text-xs bg-white px-2 py-1 rounded mr-2">
                                                                        {bg.label}: {bg.value} mg/dL
                                                                    </span>
                                                                ))}
                                                            </div>
                                                        )}
                                                    </div>
                                                    <button onClick={() => deleteExerciseSession(session.id)} className="text-red-600 hover:text-red-800">ğŸ—‘ï¸</button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}
                    </main>

                    {showRecordModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-lg max-w-md w-full p-6">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-xl font-bold">í˜ˆë‹¹ ê¸°ë¡ ì¶”ê°€</h2>
                                    <button onClick={() => setShowRecordModal(false)} className="text-gray-500 hover:text-gray-700">âŒ</button>
                                </div>
                                <div className="space-y-3">
                                    <input type="number" placeholder="í˜ˆë‹¹ (mg/dL)" value={recordForm.bloodSugar} onChange={(e) => setRecordForm({...recordForm, bloodSugar: e.target.value})} className="w-full border rounded px-3 py-2" />
                                    <input type="number" placeholder="ì¸ìŠë¦° (ë‹¨ìœ„)" value={recordForm.insulin} onChange={(e) => setRecordForm({...recordForm, insulin: e.target.value})} className="w-full border rounded px-3 py-2" step="0.5" />
                                    <input type="text" placeholder="ìŒì‹" value={recordForm.food} onChange={(e) => setRecordForm({...recordForm, food: e.target.value})} className="w-full border rounded px-3 py-2" />
                                    <input type="text" placeholder="ìš´ë™" value={recordForm.exercise} onChange={(e) => setRecordForm({...recordForm, exercise: e.target.value})} className="w-full border rounded px-3 py-2" />
                                    <textarea placeholder="ë©”ëª¨ (ì„ íƒì‚¬í•­)" value={recordForm.note} onChange={(e) => setRecordForm({...recordForm, note: e.target.value})} className="w-full border rounded px-3 py-2" rows="2"></textarea>
                                    <button onClick={addRecord} className="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">ì €ì¥</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {showExerciseModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-lg max-w-md w-full p-6">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-xl font-bold">ìš´ë™ ì„¸ì…˜ ì‹œì‘</h2>
                                    <button onClick={() => setShowExerciseModal(false)} className="text-gray-500 hover:text-gray-700">âŒ</button>
                                </div>
                                <div className="space-y-3">
                                    <select value={exerciseForm.type} onChange={(e) => setExerciseForm({...exerciseForm, type: e.target.value})} className="w-full border rounded px-3 py-2">
                                        <option value="í—¬ìŠ¤">í—¬ìŠ¤</option>
                                        <option value="ìœ ì‚°ì†Œ">ìœ ì‚°ì†Œ</option>
                                        <option value="ìš”ê°€">ìš”ê°€</option>
                                        <option value="ìˆ˜ì˜">ìˆ˜ì˜</option>
                                        <option value="ê±·ê¸°">ê±·ê¸°</option>
                                        <option value="ìì „ê±°">ìì „ê±°</option>
                                    </select>
                                    <select value={exerciseForm.intensity} onChange={(e) => setExerciseForm({...exerciseForm, intensity: e.target.value})} className="w-full border rounded px-3 py-2">
                                        <option value="ë‚®ìŒ">ë‚®ìŒ</option>
                                        <option value="ì¤‘ê°„">ì¤‘ê°„</option>
                                        <option value="ë†’ìŒ">ë†’ìŒ</option>
                                    </select>
                                    <input type="number" placeholder="ì‹œì‘ í˜ˆë‹¹ (mg/dL)" value={exerciseForm.startBG} onChange={(e) => setExerciseForm({...exerciseForm, startBG: e.target.value})} className="w-full border rounded px-3 py-2" />
                                    <button onClick={addExerciseSession} className="w-full bg-purple-600 text-white py-2 rounded hover:bg-purple-700">ìš´ë™ ì‹œì‘</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {showCalculatorModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-lg max-w-lg w-full p-6 max-h-screen overflow-y-auto">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-xl font-bold">ğŸ ì¸ìŠë¦° ê³„ì‚°ê¸°</h2>
                                    <button onClick={() => {
                                        setShowCalculatorModal(false);
                                        setCalculatedInsulin(null);
                                    }} className="text-gray-500 hover:text-gray-700">âŒ</button>
                                </div>
                                <div className="bg-yellow-50 border border-yellow-200 rounded p-3 mb-4 text-sm">
                                    <p className="font-medium text-yellow-800">âš ï¸ ê³„ì‚° ê²°ê³¼ëŠ” ì°¸ê³ ìš©ì…ë‹ˆë‹¤</p>
                                    <p className="text-yellow-700">ì‹¤ì œ ì¸ìŠë¦° íˆ¬ì—¬ ì „ ë°˜ë“œì‹œ ì£¼ì¹˜ì˜ì™€ ìƒë‹´í•˜ì„¸ìš”.</p>
                                </div>
                                <div className="space-y-3">
                                    <input type="number" placeholder="í˜„ì¬ í˜ˆë‹¹ (mg/dL)" value={calculatorForm.currentBG} onChange={(e) => setCalculatorForm({...calculatorForm, currentBG: e.target.value})} className="w-full border rounded px-3 py-2" />
                                    <input type="text" placeholder="ìŒì‹ ì´ë¦„ (ì„ íƒì‚¬í•­)" value={calculatorForm.foodName} onChange={(e) => setCalculatorForm({...calculatorForm, foodName: e.target.value})} className="w-full border rounded px-3 py-2" />
                                    <input type="number" placeholder="íƒ„ìˆ˜í™”ë¬¼ (g)" value={calculatorForm.carbs} onChange={(e) => setCalculatorForm({...calculatorForm, carbs: e.target.value})} className="w-full border rounded px-3 py-2" step="0.1" />
                                    <button onClick={calculateInsulin} className="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">ì¸ìŠë¦° ê³„ì‚°í•˜ê¸°</button>
                                    
                                    {calculatedInsulin && (
                                        <div className="bg-blue-50 border border-blue-200 rounded p-4">
                                            <h3 className="font-semibold mb-2">ê³„ì‚° ê²°ê³¼</h3>
                                            <div className="space-y-1 text-sm">
                                                <p>â€¢ íƒ„ìˆ˜í™”ë¬¼ ì²˜ë¦¬: {calculatedInsulin.carb} ë‹¨ìœ„</p>
                                                <p>â€¢ í˜ˆë‹¹ ë³´ì •: {calculatedInsulin.correction} ë‹¨ìœ„</p>
                                                <p>â€¢ í•©ê³„: {calculatedInsulin.total} ë‹¨ìœ„</p>
                                                <p className="text-lg font-bold text-blue-600 mt-2">â†’ ê¶Œì¥ íˆ¬ì—¬ëŸ‰: {calculatedInsulin.rounded} ë‹¨ìœ„</p>
                                            </div>
                                            <button onClick={saveCalculatorAsRecord} className="w-full mt-3 bg-green-600 text-white py-2 rounded hover:bg-green-700">âœ… ê¸°ë¡ìœ¼ë¡œ ì €ì¥</button>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    )}

                    {showSettingsModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-lg max-w-md w-full p-6">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-xl font-bold">ì„¤ì •</h2>
                                    <button onClick={() => setShowSettingsModal(false)} className="text-gray-500 hover:text-gray-700">âŒ</button>
                                </div>
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium mb-1">ì¸ìŠë¦°-íƒ„ìˆ˜í™”ë¬¼ ë¹„ìœ¨ (ICR)</label>
                                        <input type="number" value={settings.icr} onChange={(e) => { const newSettings = {...settings, icr: parseFloat(e.target.value) || 10}; setCurrentProfile({...currentProfile, settings: newSettings}); }} className="w-full border rounded px-3 py-2" step="0.5" min="1" />
                                        <p className="text-xs text-gray-500 mt-1">1ë‹¨ìœ„ ì¸ìŠë¦°ì´ ì²˜ë¦¬í•˜ëŠ” íƒ„ìˆ˜í™”ë¬¼(g)</p>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">ì¸ìŠë¦° ë¯¼ê°ë„ ê³„ìˆ˜ (ISF)</label>
                                        <input type="number" value={settings.isf} onChange={(e) => { const newSettings = {...settings, isf: parseFloat(e.target.value) || 50}; setCurrentProfile({...currentProfile, settings: newSettings}); }} className="w-full border rounded px-3 py-2" min="1" />
                                        <p className="text-xs text-gray-500 mt-1">1ë‹¨ìœ„ ì¸ìŠë¦°ìœ¼ë¡œ ë‚®ì¶œ ìˆ˜ ìˆëŠ” í˜ˆë‹¹(mg/dL)</p>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">ëª©í‘œ í˜ˆë‹¹ (mg/dL)</label>
                                        <input type="number" value={settings.targetBG} onChange={(e) => { const newSettings = {...settings, targetBG: parseFloat(e.target.value) || 120}; setCurrentProfile({...currentProfile, settings: newSettings}); }} className="w-full border rounded px-3 py-2" min="70" max="180" />
                                    </div>
                                    <button onClick={() => setShowSettingsModal(false)} className="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">ì €ì¥</button>
                                </div>
                            </div>
                        </div>
                    )}

                    <footer className="mt-8 py-4 text-center text-sm text-gray-500 bg-white">
                        <p>ë³¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ì˜ë£Œ ì „ë¬¸ê°€ì˜ ì¡°ì–¸ì„ ëŒ€ì²´í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                        <p className="mt-1">ëŒ€í•œë‹¹ë‡¨ë³‘í•™íšŒ ë° ë³´ê±´ë³µì§€ë¶€ ì§€ì¹¨ì„ ì°¸ê³ í•˜ì—¬ ì œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
                    </footer>
                </div>
            );
        }

        ReactDOM.render(<DiabetesApp />, document.getElementById('root'));
    </script>
</body>
</html>
