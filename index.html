<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DiaLife Pro - ë‹¹ë‡¨ë³‘ ê´€ë¦¬</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .icon { display: inline-block; width: 1em; height: 1em; vertical-align: middle; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const Heart = () => React.createElement('span', { className: 'icon' }, 'â¤ï¸');
        const Settings = () => React.createElement('span', { className: 'icon' }, 'âš™ï¸');
        const LogOut = () => React.createElement('span', { className: 'icon' }, 'ğŸšª');
        const Edit = () => React.createElement('span', { className: 'icon' }, 'âœï¸');
        const Trash = () => React.createElement('span', { className: 'icon' }, 'ğŸ—‘ï¸');
        const Check = () => React.createElement('span', { className: 'icon' }, 'âœ…');
        const X = () => React.createElement('span', { className: 'icon' }, 'âŒ');

        const DiabetesApp = () => {
            const [currentUser, setCurrentUser] = useState(null);
            const [authMode, setAuthMode] = useState('login');
            const [authData, setAuthData] = useState({ username: '', password: '', confirmPassword: '' });
            const [bloodSugar, setBloodSugar] = useState('');
            const [notifications, setNotifications] = useState([]);
            const [editingRecord, setEditingRecord] = useState(null);
            const [showSettings, setShowSettings] = useState(false);

            const [userDatabase, setUserDatabase] = useState(() => {
                try {
                    const saved = localStorage.getItem('diabetesApp_users');
                    return saved ? JSON.parse(saved) : {};
                } catch {
                    return {};
                }
            });

            const [userSettings, setUserSettings] = useState({
                targetMin: 80,
                targetMax: 180
            });

            const [personalData, setPersonalData] = useState({
                bloodSugars: [],
                stats: { totalRecords: 0 }
            });

            const saveToStorage = (key, data) => {
                try {
                    localStorage.setItem(key, JSON.stringify(data));
                } catch (error) {
                    console.error('Save failed:', error);
                }
            };

            const addNotification = (type, title, message) => {
                const notification = {
                    id: Date.now(),
                    type,
                    title,
                    message
                };
                setNotifications(prev => [...prev, notification]);
                setTimeout(() => {
                    setNotifications(prev => prev.filter(n => n.id !== notification.id));
                }, 3000);
            };

            const updateUserData = (newData) => {
                if (!currentUser) return;
                
                const updatedUser = {
                    ...currentUser,
                    settings: userSettings,
                    data: newData
                };

                const updatedDatabase = {
                    ...userDatabase,
                    [currentUser.username]: updatedUser
                };

                setUserDatabase(updatedDatabase);
                setCurrentUser(updatedUser);
                saveToStorage('diabetesApp_users', updatedDatabase);
            };

            const handleAuth = () => {
                if (authMode === 'register') {
                    if (authData.password !== authData.confirmPassword) {
                        alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                        return;
                    }
                    if (userDatabase[authData.username]) {
                        alert('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì‚¬ìš©ìëª…ì…ë‹ˆë‹¤.');
                        return;
                    }

                    const newUser = {
                        username: authData.username,
                        password: authData.password,
                        settings: userSettings,
                        data: personalData
                    };

                    const updatedDatabase = {
                        ...userDatabase,
                        [authData.username]: newUser
                    };

                    setUserDatabase(updatedDatabase);
                    setCurrentUser(newUser);
                    saveToStorage('diabetesApp_users', updatedDatabase);
                    addNotification('success', 'í™˜ì˜í•©ë‹ˆë‹¤!', 'íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                } else {
                    const user = userDatabase[authData.username];
                    if (!user || user.password !== authData.password) {
                        alert('ì‚¬ìš©ìëª… ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                        return;
                    }
                    setCurrentUser(user);
                    setUserSettings(user.settings || userSettings);
                    setPersonalData(user.data || personalData);
                    addNotification('success', 'í™˜ì˜í•©ë‹ˆë‹¤!', user.username + 'ë‹˜');
                }
                setAuthData({ username: '', password: '', confirmPassword: '' });
            };

            const addBloodSugarRecord = (value) => {
                const record = {
                    id: Date.now(),
                    value: parseFloat(value),
                    timestamp: new Date().toISOString()
                };

                const newData = {
                    ...personalData,
                    bloodSugars: [...personalData.bloodSugars, record],
                    stats: {
                        totalRecords: personalData.stats.totalRecords + 1
                    }
                };

                setPersonalData(newData);
                updateUserData(newData);

                const bgNum = parseFloat(value);
                if (bgNum < userSettings.targetMin) {
                    addNotification('warning', 'ì €í˜ˆë‹¹ ì£¼ì˜', 'ê°„ì‹ì„ ë“œì„¸ìš”!');
                } else if (bgNum > userSettings.targetMax) {
                    addNotification('warning', 'ê³ í˜ˆë‹¹ ì£¼ì˜', 'ë¬¼ì„ ì¶©ë¶„íˆ ë“œì„¸ìš”!');
                } else {
                    addNotification('success', 'ì¢‹ì•„ìš”!', 'ëª©í‘œ ë²”ìœ„ ì•ˆì— ìˆìŠµë‹ˆë‹¤!');
                }
            };

            const deleteRecord = (id) => {
                if (confirm('ì´ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    const newData = {
                        ...personalData,
                        bloodSugars: personalData.bloodSugars.filter(record => record.id !== id),
                        stats: {
                            totalRecords: Math.max(0, personalData.stats.totalRecords - 1)
                        }
                    };
                    setPersonalData(newData);
                    updateUserData(newData);
                    addNotification('info', 'ì‚­ì œ ì™„ë£Œ', 'ê¸°ë¡ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                }
            };

            const editRecord = (id, newValue) => {
                const newData = {
                    ...personalData,
                    bloodSugars: personalData.bloodSugars.map(record => 
                        record.id === id ? { ...record, value: parseFloat(newValue) } : record
                    )
                };
                setPersonalData(newData);
                updateUserData(newData);
                setEditingRecord(null);
                addNotification('success', 'ìˆ˜ì • ì™„ë£Œ', 'ê¸°ë¡ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
            };

            const getBGStatus = (bg) => {
                const bgNum = parseFloat(bg);
                if (bgNum < userSettings.targetMin) {
                    return { color: 'text-orange-600', bgColor: 'bg-orange-50', status: 'ë‚®ìŒ' };
                }
                if (bgNum > userSettings.targetMax) {
                    return { color: 'text-red-600', bgColor: 'bg-red-50', status: 'ë†’ìŒ' };
                }
                return { color: 'text-green-600', bgColor: 'bg-green-50', status: 'ì¢‹ìŒ' };
            };

            const handleLogout = () => {
                setCurrentUser(null);
                setNotifications([]);
                setShowSettings(false);
            };

            // ë¡œê·¸ì¸ í™”ë©´
            if (!currentUser) {
                return React.createElement('div', { className: "min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center" },
                    React.createElement('div', { className: "bg-white p-8 rounded-2xl shadow-xl border max-w-md w-full" },
                        React.createElement('div', { className: "text-center mb-8" },
                            React.createElement('div', { className: "bg-blue-600 p-4 rounded-xl inline-block mb-4" },
                                React.createElement(Heart, { className: "text-3xl" })
                            ),
                            React.createElement('h1', { className: "text-2xl font-bold text-gray-800" }, "DiaLife Pro"),
                            React.createElement('p', { className: "text-gray-600 mt-2" }, "ì‰½ê³  ì•ˆì „í•œ ë‹¹ë‡¨ ê´€ë¦¬")
                        ),
                        React.createElement('div', { className: "space-y-6" },
                            React.createElement('div', { className: "flex bg-gray-100 rounded-lg p-1" },
                                React.createElement('button', {
                                    onClick: () => setAuthMode('login'),
                                    className: `flex-1 py-3 px-4 rounded-md text-sm font-medium transition-colors ${
                                        authMode === 'login' ? 'bg-white text-blue-600 shadow-sm' : 'text-gray-600'
                                    }`
                                }, "ë¡œê·¸ì¸"),
                                React.createElement('button', {
                                    onClick: () => setAuthMode('register'),
                                    className: `flex-1 py-3 px-4 rounded-md text-sm font-medium transition-colors ${
                                        authMode === 'register' ? 'bg-white text-blue-600 shadow-sm' : 'text-gray-600'
                                    }`
                                }, "íšŒì›ê°€ì…")
                            ),
                            React.createElement('div', { className: "space-y-4" },
                                React.createElement('input', {
                                    type: "text",
                                    value: authData.username,
                                    onChange: (e) => setAuthData(prev => ({ ...prev, username: e.target.value })),
                                    className: "w-full px-4 py-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-lg",
                                    placeholder: "ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”"
                                }),
                                React.createElement('input', {
                                    type: "password",
                                    value: authData.password,
                                    onChange: (e) => setAuthData(prev => ({ ...prev, password: e.target.value })),
                                    className: "w-full px-4 py-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-lg",
                                    placeholder: "ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                                }),
                                authMode === 'register' && React.createElement('input', {
                                    type: "password",
                                    value: authData.confirmPassword,
                                    onChange: (e) => setAuthData(prev => ({ ...prev, confirmPassword: e.target.value })),
                                    className: "w-full px-4 py-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-lg",
                                    placeholder: "ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì…ë ¥í•˜ì„¸ìš”"
                                })
                            ),
                            React.createElement('button', {
                                onClick: handleAuth,
                                className: "w-full bg-blue-600 hover:bg-blue-700 text-white py-4 px-4 rounded-lg font-medium transition-colors text-lg"
                            }, authMode === 'login' ? 'ë¡œê·¸ì¸' : 'íšŒì›ê°€ì…')
                        )
                    )
                );
            }

            // ì„¤ì • í™”ë©´
            if (showSettings) {
                return React.createElement('div', { className: "min-h-screen bg-gray-50" },
                    React.createElement('header', { className: "bg-white shadow-sm border-b" },
                        React.createElement('div', { className: "max-w-4xl mx-auto px-4 py-4" },
                            React.createElement('div', { className: "flex items-center justify-between" },
                                React.createElement('h1', { className: "text-xl font-bold text-gray-800" }, "ì„¤ì •"),
                                React.createElement('button', {
                                    onClick: () => setShowSettings(false),
                                    className: "bg-gray-100 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-200"
                                }, "ëŒì•„ê°€ê¸°")
                            )
                        )
                    ),
                    React.createElement('main', { className: "max-w-4xl mx-auto px-4 py-8" },
                        React.createElement('div', { className: "bg-white p-6 rounded-2xl shadow-lg border" },
                            React.createElement('h3', { className: "text-lg font-bold text-gray-800 mb-4" }, "í˜ˆë‹¹ ëª©í‘œ ë²”ìœ„"),
                            React.createElement('div', { className: "grid md:grid-cols-2 gap-4" },
                                React.createElement('div', null,
                                    React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-2" }, "ìµœì†Œê°’ (mg/dL)"),
                                    React.createElement('input', {
                                        type: "number",
                                        value: userSettings.targetMin,
                                        onChange: (e) => setUserSettings(prev => ({ ...prev, targetMin: parseInt(e.target.value) })),
                                        className: "w-full px-3 py-2 border border-gray-300 rounded-lg"
                                    })
                                ),
                                React.createElement('div', null,
                                    React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-2" }, "ìµœëŒ€ê°’ (mg/dL)"),
                                    React.createElement('input', {
                                        type: "number",
                                        value: userSettings.targetMax,
                                        onChange: (e) => setUserSettings(prev => ({ ...prev, targetMax: parseInt(e.target.value) })),
                                        className: "w-full px-3 py-2 border border-gray-300 rounded-lg"
                                    })
                                )
                            ),
                            React.createElement('button', {
                                onClick: () => {
                                    updateUserData(personalData);
                                    addNotification('success', 'ì €ì¥ ì™„ë£Œ', 'ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤');
                                },
                                className: "mt-4 bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg"
                            }, "ì €ì¥")
                        )
                    )
                );
            }

            // ë©”ì¸ í™”ë©´
            return React.createElement('div', { className: "min-h-screen bg-gray-50" },
                // ì•Œë¦¼
                notifications.length > 0 && React.createElement('div', { className: "fixed top-4 right-4 z-50 space-y-2" },
                    notifications.map(notification =>
                        React.createElement('div', { 
                            key: notification.id, 
                            className: `p-4 rounded-lg shadow-lg border max-w-sm ${
                                notification.type === 'success' ? 'bg-green-50 border-green-200 text-green-800' :
                                notification.type === 'warning' ? 'bg-orange-50 border-orange-200 text-orange-800' :
                                'bg-blue-50 border-blue-200 text-blue-800'
                            } fade-in`
                        },
                            React.createElement('p', { className: "font-medium" }, notification.title),
                            React.createElement('p', { className: "text-sm mt-1" }, notification.message)
                        )
                    )
                ),

                // í—¤ë”
                React.createElement('header', { className: "bg-white shadow-sm border-b" },
                    React.createElement('div', { className: "max-w-6xl mx-auto px-4 py-4" },
                        React.createElement('div', { className: "flex items-center justify-between" },
                            React.createElement('div', { className: "flex items-center gap-3" },
                                React.createElement(Heart, { className: "text-2xl" }),
                                React.createElement('div', null,
                                    React.createElement('h1', { className: "text-xl font-bold text-gray-800" }, "DiaLife Pro"),
                                    React.createElement('p', { className: "text-sm text-gray-600" }, currentUser.username + 'ë‹˜ì˜ ë‹¹ë‡¨ ê´€ë¦¬')
                                )
                            ),
                            React.createElement('div', { className: "flex items-center gap-3" },
                                React.createElement('button', {
                                    onClick: () => setShowSettings(true),
                                    className: "flex items-center gap-2 bg-gray-100 text-gray-700 px-3 py-2 rounded-lg text-sm hover:bg-gray-200"
                                },
                                    React.createElement(Settings),
                                    "ì„¤ì •"
                                ),
                                React.createElement('button', {
                                    onClick: handleLogout,
                                    className: "flex items-center gap-2 bg-gray-100 text-gray-700 px-3 py-2 rounded-lg text-sm hover:bg-gray-200"
                                },
                                    React.createElement(LogOut),
                                    "ë¡œê·¸ì•„ì›ƒ"
                                )
                            )
                        )
                    )
                ),

                // ë©”ì¸ ì½˜í…ì¸ 
                React.createElement('main', { className: "max-w-6xl mx-auto px-4 py-8" },
                    // í†µê³„
                    React.createElement('div', { className: "bg-gradient-to-br from-blue-50 to-blue-100 p-6 rounded-2xl border mb-6" },
                        React.createElement('div', { className: "flex items-center justify-between" },
                            React.createElement('div', null,
                                React.createElement('p', { className: "text-blue-600 font-medium" }, "ì´ ê¸°ë¡"),
                                React.createElement('p', { className: "text-3xl font-bold text-blue-800" }, personalData.stats.totalRecords),
                                React.createElement('p', { className: "text-sm text-blue-600" }, "ë²ˆ ì¸¡ì •")
                            ),
                            React.createElement('div', null,
                                React.createElement('p', { className: "text-blue-600 font-medium" }, "ëª©í‘œ ë²”ìœ„"),
                                React.createElement('p', { className: "text-lg font-bold text-blue-800" }, userSettings.targetMin + ' - ' + userSettings.targetMax),
                                React.createElement('p', { className: "text-sm text-blue-600" }, "mg/dL")
                            )
                        )
                    ),

                    // í˜ˆë‹¹ ì…ë ¥
                    React.createElement('div', { className: "bg-white p-6 rounded-2xl shadow-lg border mb-6" },
                        React.createElement('h3', { className: "text-lg font-bold text-gray-800 mb-4" }, "í˜ˆë‹¹ ê¸°ë¡í•˜ê¸°"),
                        React.createElement('div', { className: "flex gap-3 items-end" },
                            React.createElement('div', { className: "flex-1" },
                                React.createElement('input', {
                                    type: "number",
                                    value: bloodSugar,
                                    onChange: (e) => setBloodSugar(e.target.value),
                                    placeholder: "í˜ˆë‹¹ ìˆ˜ì¹˜ (mg/dL)",
                                    className: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-lg"
                                })
                            ),
                            React.createElement('button', {
                                onClick: () => {
                                    if (bloodSugar) {
                                        addBloodSugarRecord(bloodSugar);
                                        setBloodSugar('');
                                    }
                                },
                                disabled: !bloodSugar,
                                className: "bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white px-6 py-3 rounded-lg font-medium"
                            }, "ê¸°ë¡í•˜ê¸°")
                        ),
                        bloodSugar && React.createElement('div', { className: 'mt-3 p-3 rounded-lg ' + getBGStatus(bloodSugar).bgColor },
                            React.createElement('p', { className: 'font-medium ' + getBGStatus(bloodSugar).color },
                                getBGStatus(bloodSugar).status + ' ìƒíƒœì…ë‹ˆë‹¤'
                            )
                        )
                    ),

                    // ê¸°ë¡ ëª©ë¡
                    React.createElement('div', { className: "bg-white p-6 rounded-2xl shadow-lg border" },
                        React.createElement('h4', { className: "font-bold text-gray-800 mb-4 text-lg" }, "ë‚´ í˜ˆë‹¹ ê¸°ë¡"),
                        React.createElement('div', { className: "space-y-3" },
                            personalData.bloodSugars.length > 0 ? personalData.bloodSugars.slice(-10).reverse().map((record) => {
                                const status = getBGStatus(record.value);
                                return React.createElement('div', { 
                                    key: record.id, 
                                    className: 'flex items-center justify-between p-4 rounded-lg border ' + status.bgColor
                                },
                                    React.createElement('div', { className: "flex-1" },
                                        editingRecord === record.id ? 
                                            React.createElement('div', { className: "flex gap-2" },
                                                React.createElement('input', {
                                                    type: "number",
                                                    defaultValue: record.value,
                                                    className: "px-3 py-1 border border-gray-300 rounded w-24",
                                                    id: 'edit-' + record.id,
                                                    onKeyPress: (e) => {
                                                        if (e.key === 'Enter') {
                                                            editRecord(record.id, e.target.value);
                                                        }
                                                    }
                                                }),
                                                React.createElement('button', {
                                                    onClick: () => {
                                                        const input = document.getElementById('edit-' + record.id);
                                                        editRecord(record.id, input.value);
                                                    },
                                                    className: "text-green-600 hover:text-green-800"
                                                }, React.createElement(Check)),
                                                React.createElement('button', {
                                                    onClick: () => setEditingRecord(null),
                                                    className: "text-gray-600 hover:text-gray-800"
                                                }, React.createElement(X))
                                            ) :
                                            React.createElement('div', null,
                                                React.createElement('p', { className: 'font-bold text-lg ' + status.color }, record.value + ' mg/dL'),
                                                React.createElement('p', { className: "text-sm text-gray-600" }, 
                                                    new Date(record.timestamp).toLocaleString('ko-KR', {
                                                        month: 'short',
                                                        day: 'numeric',
                                                        hour: '2-digit',
                                                        minute: '2-digit'
                                                    })
                                                ),
                                                React.createElement('span', { className: 'text-sm font-medium ' + status.color }, status.status)
                                            )
                                    ),
                                    editingRecord !== record.id && React.createElement('div', { className: "flex gap-2" },
                                        React.createElement('button', {
                                            onClick: () => setEditingRecord(record.id),
                                            className: "p-2 text-blue-600 hover:text-blue-800 hover:bg-blue-100 rounded-lg"
                                        }, React.createElement(Edit)),
                                        React.createElement('button', {
                                            onClick: () => deleteRecord(record.id),
                                            className: "p-2 text-red-600 hover:text-red-800 hover:bg-red-100 rounded-lg"
                                        }, React.createElement(Trash))
                                    )
                                );
                            }) : React.createElement('div', { className: "text-center py-8 text-gray-500" },
                                React.createElement('p', { className: "text-lg" }, "ì•„ì§ ê¸°ë¡ì´ ì—†ì–´ìš”"),
                                React.createElement('p', { className: "text-sm mt-1" }, "ì²« ë²ˆì§¸ í˜ˆë‹¹ì„ ê¸°ë¡í•´ë³´ì„¸ìš”!")
                            )
                        )
                    )
                )
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(DiabetesApp));
    </script>
</body>
</html>
