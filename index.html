<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DiaLife Pro - AI ê¸°ë°˜ 1í˜•ë‹¹ë‡¨ ê°œì¸í™” ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
      line-height: 1.6;
      color: #333;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }

    .auth-container {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 1rem;
    }

    .auth-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border-radius: 2rem;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
      padding: 3rem;
      width: 100%;
      max-width: 500px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      text-align: center;
    }

    .auth-header {
      margin-bottom: 2rem;
    }

    .auth-header h1 {
      font-size: 2.5rem;
      font-weight: bold;
      background: linear-gradient(135deg, #667eea, #764ba2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 0.5rem;
    }

    .auth-header p {
      color: #6b7280;
      font-size: 1.1rem;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 1rem;
    }

    .header {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 1rem;
      padding: 1.5rem;
      margin-bottom: 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: white;
    }

    .header-left h1 {
      font-size: 2rem;
      font-weight: bold;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      margin-bottom: 0.25rem;
    }

    .header-left .welcome {
      font-size: 1.1rem;
      opacity: 0.9;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .user-info {
      text-align: right;
    }

    .user-info .user-name {
      font-weight: 600;
      font-size: 1.1rem;
    }

    .user-info .user-stats {
      font-size: 0.9rem;
      opacity: 0.8;
    }

    .main-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
      margin-bottom: 2rem;
    }

    .card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 1rem;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      padding: 1.5rem;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .card h2 {
      font-size: 1.4rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: #1f2937;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    .form-group label {
      font-size: 0.875rem;
      font-weight: 500;
      color: #374151;
      margin-bottom: 0.25rem;
    }

    .form-group input, 
    .form-group select,
    .form-group textarea {
      padding: 0.75rem;
      border: 2px solid #e5e7eb;
      border-radius: 0.5rem;
      font-size: 1rem;
      transition: all 0.2s;
      background: white;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 0.5rem;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      text-decoration: none;
    }

    .btn-primary {
      background: linear-gradient(135deg, #3b82f6, #1d4ed8);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
    }

    .btn-success {
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
    }

    .btn-ai {
      background: linear-gradient(135deg, #8b5cf6, #7c3aed);
      color: white;
    }

    .btn-exercise {
      background: linear-gradient(135deg, #f59e0b, #d97706);
      color: white;
    }

    .btn-exercise:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4);
    }

    .btn-logout {
      background: linear-gradient(135deg, #ef4444, #dc2626);
      color: white;
      padding: 0.5rem 1rem;
      font-size: 0.875rem;
    }

    .btn-danger {
      background: linear-gradient(135deg, #ef4444, #dc2626);
      color: white;
    }

    .btn-full {
      width: 100%;
      justify-content: center;
    }

    .btn-small {
      padding: 0.5rem 1rem;
      font-size: 0.875rem;
    }

    .personalized-insights {
      background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
      border: 2px solid #0284c7;
      border-radius: 1rem;
      padding: 1.5rem;
      margin-bottom: 2rem;
    }

    .insight-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1rem;
    }

    .insight-card {
      background: rgba(255, 255, 255, 0.8);
      padding: 1rem;
      border-radius: 0.75rem;
      border-left: 4px solid #0284c7;
    }

    .insight-title {
      font-weight: 600;
      color: #0c4a6e;
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .stats-dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .stat-card {
      background: linear-gradient(135deg, #f8fafc, #e2e8f0);
      padding: 1.5rem;
      border-radius: 1rem;
      text-align: center;
      border: 1px solid #e2e8f0;
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(135deg, #3b82f6, #8b5cf6);
    }

    .stat-value {
      font-size: 2rem;
      font-weight: bold;
      color: #1f2937;
      margin-bottom: 0.25rem;
    }

    .stat-label {
      font-size: 0.875rem;
      color: #6b7280;
    }

    .pattern-item {
      background: rgba(255, 255, 255, 0.8);
      border: 1px solid #e5e7eb;
      border-radius: 0.75rem;
      padding: 1rem;
      margin-bottom: 1rem;
      transition: all 0.2s;
    }

    .pattern-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .exercise-item {
      background: rgba(245, 158, 11, 0.1);
      border: 1px solid #f59e0b;
      border-radius: 0.75rem;
      padding: 1rem;
      margin-bottom: 1rem;
      transition: all 0.2s;
    }

    .exercise-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(245, 158, 11, 0.2);
    }

    .glucose-trend {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-top: 0.5rem;
    }

    .trend-indicator {
      width: 12px;
      height: 12px;
      border-radius: 50%;
    }

    .trend-good {
      background: #10b981;
    }

    .trend-warning {
      background: #f59e0b;
    }

    .trend-danger {
      background: #ef4444;
    }

    .tab-container {
      margin-bottom: 2rem;
    }

    .tab-buttons {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(10px);
      border-radius: 1rem;
      padding: 0.5rem;
      flex-wrap: wrap;
    }

    .tab-button {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 0.75rem;
      background: transparent;
      color: white;
      cursor: pointer;
      transition: all 0.2s;
      font-weight: 500;
      font-size: 0.9rem;
    }

    .tab-button.active {
      background: rgba(255, 255, 255, 0.95);
      color: #1f2937;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .full-width {
      grid-column: 1 / -1;
    }

    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 1rem;
      padding: 2rem;
      color: #6b7280;
    }

    .spinner {
      width: 20px;
      height: 20px;
      border: 2px solid #e5e7eb;
      border-top: 2px solid #3b82f6;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .preview-box {
      background: linear-gradient(135deg, #eff6ff, #dbeafe);
      border: 2px solid #3b82f6;
      border-radius: 1rem;
      padding: 1rem;
      margin-top: 1rem;
    }

    .exercise-preview {
      background: linear-gradient(135deg, #fef3c7, #fde68a);
      border: 2px solid #f59e0b;
      border-radius: 1rem;
      padding: 1rem;
      margin-top: 1rem;
    }

    .personal-analysis {
      background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
      border: 2px solid #0284c7;
      border-radius: 1rem;
      padding: 1rem;
      margin-top: 1rem;
    }

    .ai-recommendations {
      background: linear-gradient(135deg, #f3e8ff, #e9d5ff);
      border: 2px solid #8b5cf6;
      border-radius: 1rem;
      padding: 1.5rem;
      margin-top: 1rem;
    }

    .exercise-safety {
      background: linear-gradient(135deg, #fef2f2, #fee2e2);
      border: 2px solid #ef4444;
      border-radius: 1rem;
      padding: 1.5rem;
      margin-top: 1rem;
    }

    .hidden {
      display: none;
    }

    .food-suggestions {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 0.5rem;
      max-height: 200px;
      overflow-y: auto;
      z-index: 1000;
      display: none;
    }

    .food-suggestion {
      padding: 0.75rem;
      cursor: pointer;
      border-bottom: 1px solid #f3f4f6;
      display: flex;
      justify-content: space-between;
    }

    .food-suggestion:hover {
      background: #f9fafb;
    }

    .food-search {
      position: relative;
    }

    .timer-display {
      font-size: 2rem;
      font-weight: bold;
      text-align: center;
      margin: 1rem 0;
      color: #f59e0b;
    }

    .timer-controls {
      display: flex;
      gap: 1rem;
      justify-content: center;
      margin-bottom: 1rem;
    }

    @media (max-width: 1024px) {
      .main-grid {
        grid-template-columns: 1fr;
      }
      
      .header {
        flex-direction: column;
        gap: 1rem;
        text-align: center;
      }
    }

    @media (max-width: 768px) {
      .container {
        padding: 0.5rem;
      }
      
      .form-grid {
        grid-template-columns: 1fr;
      }
      
      .insight-grid {
        grid-template-columns: 1fr;
      }
      
      .stats-dashboard {
        grid-template-columns: repeat(2, 1fr);
      }

      .tab-buttons {
        flex-wrap: wrap;
      }

      .tab-button {
        padding: 0.5rem 1rem;
        font-size: 0.875rem;
      }
    }
  </style>
</head>
<body>
  <div id="app">
    <div class="loading">
      <div class="spinner"></div>
      ì‹œìŠ¤í…œì„ ì´ˆê¸°í™”í•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤...
    </div>
  </div>

  <script>
    // í•œêµ­ ì‹í’ˆ ë°ì´í„°ë² ì´ìŠ¤ (ì‹í’ˆì˜ì•½í’ˆì•ˆì „ì²˜ ê¸°ì¤€)
    const KOREAN_FOOD_DATABASE = {
      // ì£¼ì‹ë¥˜
      'ë°±ë¯¸ë°¥': { carbs: 23, protein: 2.5, fat: 0.3, category: 'ì£¼ì‹', serving: 100, glycemicIndex: 73, source: 'ì‹ì•½ì²˜' },
      'í˜„ë¯¸ë°¥': { carbs: 22, protein: 2.8, fat: 0.9, category: 'ì£¼ì‹', serving: 100, glycemicIndex: 56, source: 'ì‹ì•½ì²˜' },
      'ë³´ë¦¬ë°¥': { carbs: 21, protein: 3.2, fat: 0.7, category: 'ì£¼ì‹', serving: 100, glycemicIndex: 25, source: 'ì‹ì•½ì²˜' },
      'ê¹€ë°¥': { carbs: 35, protein: 6, fat: 4, category: 'ì£¼ì‹', serving: 100, glycemicIndex: 65, source: 'ì‹ì•½ì²˜' },
      'ë¼ë©´': { carbs: 55, protein: 9, fat: 16, category: 'ë©´ë¥˜', serving: 100, glycemicIndex: 73, source: 'ì‹ì•½ì²˜' },
      'ëƒ‰ë©´': { carbs: 19, protein: 4, fat: 0.5, category: 'ë©´ë¥˜', serving: 100, glycemicIndex: 40, source: 'ì‹ì•½ì²˜' },
      'ìš°ë™': { carbs: 21, protein: 3, fat: 0.4, category: 'ë©´ë¥˜', serving: 100, glycemicIndex: 55, source: 'ì‹ì•½ì²˜' },
      'ì‹ë¹µ': { carbs: 47, protein: 8, fat: 4, category: 'ì£¼ì‹', serving: 100, glycemicIndex: 75, source: 'ì‹ì•½ì²˜' },
      'ì°ë¹µ': { carbs: 45, protein: 6, fat: 2, category: 'ì£¼ì‹', serving: 100, glycemicIndex: 65, source: 'ì‹ì•½ì²˜' },
      
      // ê³¼ì¼ë¥˜
      'ì‚¬ê³¼': { carbs: 14, protein: 0.3, fat: 0.2, category: 'ê³¼ì¼', serving: 100, glycemicIndex: 36, source: 'ì‹ì•½ì²˜' },
      'ë°°': { carbs: 11, protein: 0.3, fat: 0.1, category: 'ê³¼ì¼', serving: 100, glycemicIndex: 33, source: 'ì‹ì•½ì²˜' },
      'ë°”ë‚˜ë‚˜': { carbs: 23, protein: 1, fat: 0.2, category: 'ê³¼ì¼', serving: 100, glycemicIndex: 51, source: 'ì‹ì•½ì²˜' },
      'ì˜¤ë Œì§€': { carbs: 12, protein: 0.9, fat: 0.1, category: 'ê³¼ì¼', serving: 100, glycemicIndex: 42, source: 'ì‹ì•½ì²˜' },
      'í¬ë„': { carbs: 16, protein: 0.6, fat: 0.2, category: 'ê³¼ì¼', serving: 100, glycemicIndex: 46, source: 'ì‹ì•½ì²˜' },
      'ìˆ˜ë°•': { carbs: 8, protein: 0.6, fat: 0.2, category: 'ê³¼ì¼', serving: 100, glycemicIndex: 72, source: 'ì‹ì•½ì²˜' },
      'ë”¸ê¸°': { carbs: 8, protein: 0.7, fat: 0.3, category: 'ê³¼ì¼', serving: 100, glycemicIndex: 40, source: 'ì‹ì•½ì²˜' },
      'ê°': { carbs: 16, protein: 0.5, fat: 0.1, category: 'ê³¼ì¼', serving: 100, glycemicIndex: 55, source: 'ì‹ì•½ì²˜' },
      'ë³µìˆ­ì•„': { carbs: 10, protein: 0.9, fat: 0.3, category: 'ê³¼ì¼', serving: 100, glycemicIndex: 35, source: 'ì‹ì•½ì²˜' },
      'ìëª½': { carbs: 11, protein: 0.8, fat: 0.1, category: 'ê³¼ì¼', serving: 100, glycemicIndex: 25, source: 'ì‹ì•½ì²˜' },
      
      // ì±„ì†Œë¥˜
      'ë°°ì¶”ê¹€ì¹˜': { carbs: 3, protein: 1.1, fat: 0.4, category: 'ì±„ì†Œ', serving: 100, glycemicIndex: 15, source: 'ì‹ì•½ì²˜' },
      'ë¬´': { carbs: 2, protein: 0.5, fat: 0.1, category: 'ì±„ì†Œ', serving: 100, glycemicIndex: 10, source: 'ì‹ì•½ì²˜' },
      'ë‹¹ê·¼': { carbs: 8, protein: 0.7, fat: 0.2, category: 'ì±„ì†Œ', serving: 100, glycemicIndex: 47, source: 'ì‹ì•½ì²˜' },
      'ê°ì': { carbs: 17, protein: 2, fat: 0.1, category: 'ì±„ì†Œ', serving: 100, glycemicIndex: 62, source: 'ì‹ì•½ì²˜' },
      'ê³ êµ¬ë§ˆ': { carbs: 20, protein: 1.2, fat: 0.2, category: 'ì±„ì†Œ', serving: 100, glycemicIndex: 48, source: 'ì‹ì•½ì²˜' },
      'ì˜¥ìˆ˜ìˆ˜': { carbs: 19, protein: 3.2, fat: 1.2, category: 'ì±„ì†Œ', serving: 100, glycemicIndex: 52, source: 'ì‹ì•½ì²˜' },
      'ë¸Œë¡œì½œë¦¬': { carbs: 5, protein: 2.8, fat: 0.4, category: 'ì±„ì†Œ', serving: 100, glycemicIndex: 10, source: 'ì‹ì•½ì²˜' },
      'ì‹œê¸ˆì¹˜': { carbs: 3, protein: 2.9, fat: 0.4, category: 'ì±„ì†Œ', serving: 100, glycemicIndex: 15, source: 'ì‹ì•½ì²˜' },
      
      // ë‹¨ë°±ì§ˆë¥˜
      'ë‹­ê°€ìŠ´ì‚´': { carbs: 0, protein: 23, fat: 1.2, category: 'ë‹¨ë°±ì§ˆ', serving: 100, glycemicIndex: 0, source: 'ì‹ì•½ì²˜' },
      'ê³„ë€': { carbs: 0.7, protein: 13, fat: 11, category: 'ë‹¨ë°±ì§ˆ', serving: 100, glycemicIndex: 0, source: 'ì‹ì•½ì²˜' },
      'ë‘ë¶€': { carbs: 2, protein: 8, fat: 4, category: 'ë‹¨ë°±ì§ˆ', serving: 100, glycemicIndex: 15, source: 'ì‹ì•½ì²˜' },
      'ì‚¼ê²¹ì‚´': { carbs: 0, protein: 17, fat: 28, category: 'ë‹¨ë°±ì§ˆ', serving: 100, glycemicIndex: 0, source: 'ì‹ì•½ì²˜' },
      'ê°ˆë¹„': { carbs: 0, protein: 19, fat: 25, category: 'ë‹¨ë°±ì§ˆ', serving: 100, glycemicIndex: 0, source: 'ì‹ì•½ì²˜' },
      'ìƒì„ ': { carbs: 0, protein: 20, fat: 5, category: 'ë‹¨ë°±ì§ˆ', serving: 100, glycemicIndex: 0, source: 'ì‹ì•½ì²˜' },
      'ì½©': { carbs: 11, protein: 16, fat: 8, category: 'ë‹¨ë°±ì§ˆ', serving: 100, glycemicIndex: 30, source: 'ì‹ì•½ì²˜' },
      
      // ìœ ì œí’ˆë¥˜
      'ìš°ìœ ': { carbs: 5, protein: 3.3, fat: 3.2, category: 'ìœ ì œí’ˆ', serving: 100, glycemicIndex: 39, source: 'ì‹ì•½ì²˜' },
      'ìš”êµ¬ë¥´íŠ¸': { carbs: 7, protein: 3.5, fat: 3, category: 'ìœ ì œí’ˆ', serving: 100, glycemicIndex: 41, source: 'ì‹ì•½ì²˜' },
      'ì¹˜ì¦ˆ': { carbs: 1, protein: 25, fat: 33, category: 'ìœ ì œí’ˆ', serving: 100, glycemicIndex: 0, source: 'ì‹ì•½ì²˜' },
      
      // ê°„ì‹ë¥˜
      'ì´ˆì½œë¦¿': { carbs: 57, protein: 4, fat: 31, category: 'ê°„ì‹', serving: 100, glycemicIndex: 40, source: 'ì‹ì•½ì²˜' },
      'ì¿ í‚¤': { carbs: 67, protein: 6, fat: 24, category: 'ê°„ì‹', serving: 100, glycemicIndex: 77, source: 'ì‹ì•½ì²˜' },
      'ì•„ì´ìŠ¤í¬ë¦¼': { carbs: 24, protein: 3, fat: 11, category: 'ê°„ì‹', serving: 100, glycemicIndex: 51, source: 'ì‹ì•½ì²˜' },
      'ë–¡': { carbs: 44, protein: 4, fat: 0.5, category: 'ê°„ì‹', serving: 100, glycemicIndex: 83, source: 'ì‹ì•½ì²˜' },
      
      // ê²¬ê³¼ë¥˜
      'ì•„ëª¬ë“œ': { carbs: 6, protein: 21, fat: 49, category: 'ê²¬ê³¼ë¥˜', serving: 100, glycemicIndex: 0, source: 'ì‹ì•½ì²˜' },
      'í˜¸ë‘': { carbs: 7, protein: 15, fat: 65, category: 'ê²¬ê³¼ë¥˜', serving: 100, glycemicIndex: 0, source: 'ì‹ì•½ì²˜' },
      
      // ìŒë£Œë¥˜
      'ì˜¤ë Œì§€ì£¼ìŠ¤': { carbs: 11, protein: 0.7, fat: 0.2, category: 'ìŒë£Œ', serving: 100, glycemicIndex: 50, source: 'ì‹ì•½ì²˜' },
      'ì‚¬ê³¼ì£¼ìŠ¤': { carbs: 11, protein: 0.1, fat: 0.1, category: 'ìŒë£Œ', serving: 100, glycemicIndex: 44, source: 'ì‹ì•½ì²˜' }
    };

    // ìš´ë™ ì¢…ëª© ë°ì´í„°ë² ì´ìŠ¤
    const EXERCISE_DATABASE = {
      // ìœ ì‚°ì†Œ ìš´ë™
      'ê±·ê¸°': { type: 'aerobic', intensity: 'low', caloriesPerMinute: 4, glucoseEffect: -15, category: 'ìœ ì‚°ì†Œ' },
      'ì¡°ê¹…': { type: 'aerobic', intensity: 'medium', caloriesPerMinute: 8, glucoseEffect: -25, category: 'ìœ ì‚°ì†Œ' },
      'ë‹¬ë¦¬ê¸°': { type: 'aerobic', intensity: 'high', caloriesPerMinute: 12, glucoseEffect: -35, category: 'ìœ ì‚°ì†Œ' },
      'ìì „ê±°': { type: 'aerobic', intensity: 'medium', caloriesPerMinute: 7, glucoseEffect: -20, category: 'ìœ ì‚°ì†Œ' },
      'ìˆ˜ì˜': { type: 'aerobic', intensity: 'high', caloriesPerMinute: 10, glucoseEffect: -30, category: 'ìœ ì‚°ì†Œ' },
      'ë“±ì‚°': { type: 'aerobic', intensity: 'medium', caloriesPerMinute: 8, glucoseEffect: -25, category: 'ìœ ì‚°ì†Œ' },
      'ëŒ„ìŠ¤': { type: 'aerobic', intensity: 'medium', caloriesPerMinute: 6, glucoseEffect: -20, category: 'ìœ ì‚°ì†Œ' },
      
      // ë¬´ì‚°ì†Œ ìš´ë™
      'í—¬ìŠ¤(ì›¨ì´íŠ¸)': { type: 'anaerobic', intensity: 'high', caloriesPerMinute: 5, glucoseEffect: -10, category: 'ê·¼ë ¥ìš´ë™' },
      'í’€ì—…': { type: 'anaerobic', intensity: 'high', caloriesPerMinute: 6, glucoseEffect: -10, category: 'ê·¼ë ¥ìš´ë™' },
      'í‘¸ì‰¬ì—…': { type: 'anaerobic', intensity: 'medium', caloriesPerMinute: 4, glucoseEffect: -8, category: 'ê·¼ë ¥ìš´ë™' },
      'ìŠ¤ì¿¼íŠ¸': { type: 'anaerobic', intensity: 'medium', caloriesPerMinute: 5, glucoseEffect: -10, category: 'ê·¼ë ¥ìš´ë™' },
      'ë°ë“œë¦¬í”„íŠ¸': { type: 'anaerobic', intensity: 'high', caloriesPerMinute: 6, glucoseEffect: -12, category: 'ê·¼ë ¥ìš´ë™' },
      'ë²¤ì¹˜í”„ë ˆìŠ¤': { type: 'anaerobic', intensity: 'high', caloriesPerMinute: 5, glucoseEffect: -10, category: 'ê·¼ë ¥ìš´ë™' },
      
      // í˜¼í•© ìš´ë™
      'í¬ë¡œìŠ¤í•': { type: 'mixed', intensity: 'high', caloriesPerMinute: 12, glucoseEffect: -30, category: 'ê³ ê°•ë„' },
      'ì„œí‚·íŠ¸ë ˆì´ë‹': { type: 'mixed', intensity: 'high', caloriesPerMinute: 10, glucoseEffect: -25, category: 'ê³ ê°•ë„' },
      'ë³µì‹±': { type: 'mixed', intensity: 'high', caloriesPerMinute: 11, glucoseEffect: -28, category: 'ê³ ê°•ë„' },
      'íƒœê¶Œë„': { type: 'mixed', intensity: 'medium', caloriesPerMinute: 8, glucoseEffect: -20, category: 'ë¬´ìˆ ' },
      'ìš”ê°€': { type: 'mixed', intensity: 'low', caloriesPerMinute: 3, glucoseEffect: -5, category: 'ìœ ì—°ì„±' },
      'í•„ë¼í…ŒìŠ¤': { type: 'mixed', intensity: 'low', caloriesPerMinute: 4, glucoseEffect: -8, category: 'ìœ ì—°ì„±' },
      
      // êµ¬ê¸°ì¢…ëª©
      'ì¶•êµ¬': { type: 'sport', intensity: 'high', caloriesPerMinute: 10, glucoseEffect: -25, category: 'êµ¬ê¸°ì¢…ëª©' },
      'ë†êµ¬': { type: 'sport', intensity: 'high', caloriesPerMinute: 9, glucoseEffect: -22, category: 'êµ¬ê¸°ì¢…ëª©' },
      'í…Œë‹ˆìŠ¤': { type: 'sport', intensity: 'medium', caloriesPerMinute: 7, glucoseEffect: -18, category: 'êµ¬ê¸°ì¢…ëª©' },
      'ë°°ë“œë¯¼í„´': { type: 'sport', intensity: 'medium', caloriesPerMinute: 6, glucoseEffect: -15, category: 'êµ¬ê¸°ì¢…ëª©' },
      'íƒêµ¬': { type: 'sport', intensity: 'medium', caloriesPerMinute: 5, glucoseEffect: -12, category: 'êµ¬ê¸°ì¢…ëª©' },
      'ë³¼ë§': { type: 'sport', intensity: 'low', caloriesPerMinute: 3, glucoseEffect: -8, category: 'êµ¬ê¸°ì¢…ëª©' }
    };

    // Claude AIë¥¼ í™œìš©í•œ ê°œì¸í™” ë¶„ì„ ì‹œìŠ¤í…œ
    class PersonalizedAIEngine {
      constructor() {
        this.personalPatterns = {};
        this.learningData = {};
      }

      // ê°œì¸í™”ëœ ì¸ìŠë¦° ê³„ì‚°
      calculatePersonalizedInsulin(glucose, carbs, personalData) {
        // ê¸°ë³¸ ê³„ì‚°ë²• (ICR + ISF)
        const baseICR = 15; // ì´ˆê¸° ì¸ìŠë¦°-íƒ„ìˆ˜í™”ë¬¼ ë¹„ìœ¨
        const baseISF = 50; // ì´ˆê¸° ì¸ìŠë¦° ê°ìˆ˜ì„± ì§€ìˆ˜
        
        // ê°œì¸ ë°ì´í„° ê¸°ë°˜ ì¡°ì •
        let personalICR = baseICR;
        let personalISF = baseISF;
        
        if (personalData && personalData.records && personalData.records.length > 10) {
          const successfulResults = personalData.records.filter(record => {
            return record.postMealGlucose && 
                   record.postMealGlucose >= 80 && 
                   record.postMealGlucose <= 180 &&
                   record.carbs > 0 && record.insulin > 0;
          });
          
          if (successfulResults.length > 5) {
            const avgICR = successfulResults.reduce((sum, record) => {
              return sum + (record.carbs / record.insulin);
            }, 0) / successfulResults.length;
            
            personalICR = Math.round(avgICR * 10) / 10;
          }
        }
        
        // ì¸ìŠë¦° ê³„ì‚°
        const carbInsulin = carbs / personalICR;
        const correctionInsulin = glucose > 120 ? (glucose - 120) / personalISF : 0;
        
        return {
          carbInsulin: Math.round(carbInsulin * 10) / 10,
          correctionInsulin: Math.round(correctionInsulin * 10) / 10,
          total: Math.round((carbInsulin + correctionInsulin) * 10) / 10,
          confidence: personalData.records && personalData.records.length > 10 ? Math.min(personalData.records.length * 10, 100) : 20,
          personalICR: personalICR,
          personalISF: personalISF
        };
      }

      // ìš´ë™ê³¼ í˜ˆë‹¹ì˜ ê´€ê³„ ë¶„ì„
      analyzeExerciseGlucoseRelation(exerciseRecords) {
        const patterns = {};
        
        exerciseRecords.forEach(record => {
          const exerciseType = record.exerciseType;
          if (!patterns[exerciseType]) {
            patterns[exerciseType] = {
              count: 0,
              avgGlucoseChange: 0,
              glucoseChanges: [],
              avgDuration: 0,
              safetyLevel: 'unknown'
            };
          }
          
          const pattern = patterns[exerciseType];
          pattern.count++;
          
          if (record.preExerciseGlucose && record.postExerciseGlucose) {
            const change = record.postExerciseGlucose - record.preExerciseGlucose;
            pattern.glucoseChanges.push(change);
            pattern.avgGlucoseChange = Math.round(
              pattern.glucoseChanges.reduce((sum, val) => sum + val, 0) / pattern.glucoseChanges.length
            );
          }
          
          pattern.avgDuration = Math.round(
            (pattern.avgDuration * (pattern.count - 1) + record.duration) / pattern.count
          );
          
          // ì•ˆì „ë„ í‰ê°€
          if (pattern.avgGlucoseChange > -20 && pattern.avgGlucoseChange < 0) {
            pattern.safetyLevel = 'safe';
          } else if (pattern.avgGlucoseChange <= -50) {
            pattern.safetyLevel = 'high_risk';
          } else {
            pattern.safetyLevel = 'moderate';
          }
        });
        
        return patterns;
      }

      // AI ê¸°ë°˜ ìš´ë™ ì „ í˜ˆë‹¹ ê¶Œê³ 
      getExerciseRecommendation(currentGlucose, exerciseType, mealTiming) {
        const exerciseData = EXERCISE_DATABASE[exerciseType];
        if (!exerciseData) return null;
        
        const recommendations = [];
        
        // í˜ˆë‹¹ë³„ ìš´ë™ ì•ˆì „ì„± í‰ê°€
        if (currentGlucose < 100) {
          recommendations.push({
            type: 'warning',
            message: 'ìš´ë™ ì „ í˜ˆë‹¹ì´ ë‚®ìŠµë‹ˆë‹¤. 15g íƒ„ìˆ˜í™”ë¬¼ì„ ì„­ì·¨í•œ í›„ 15ë¶„ ê¸°ë‹¤ë¦° ë‹¤ìŒ ìš´ë™í•˜ì„¸ìš”.',
            priority: 'high'
          });
        } else if (currentGlucose > 250) {
          recommendations.push({
            type: 'danger',
            message: 'í˜ˆë‹¹ì´ ë„ˆë¬´ ë†’ìŠµë‹ˆë‹¤. ì¼€í†¤ ê²€ì‚¬ë¥¼ í•˜ê³  ì˜ë£Œì§„ê³¼ ìƒë‹´ í›„ ìš´ë™í•˜ì„¸ìš”.',
            priority: 'critical'
          });
        } else if (currentGlucose > 180) {
          recommendations.push({
            type: 'caution',
            message: 'í˜ˆë‹¹ì´ ë†’ì§€ë§Œ ìš´ë™ ê°€ëŠ¥í•©ë‹ˆë‹¤. ìˆ˜ë¶„ì„ ì¶©ë¶„íˆ ì„­ì·¨í•˜ì„¸ìš”.',
            priority: 'medium'
          });
        }
        
        // ì‹ì‚¬ì™€ ìš´ë™ íƒ€ì´ë° ê¶Œê³ 
        if (mealTiming === 'fasting' && exerciseData.intensity === 'high') {
          recommendations.push({
            type: 'info',
            message: 'ê³µë³µ ìƒíƒœì—ì„œ ê³ ê°•ë„ ìš´ë™ ì‹œ ì €í˜ˆë‹¹ ìœ„í—˜ì´ ë†’ìŠµë‹ˆë‹¤. í˜ˆë‹¹ì„ ìì£¼ ì²´í¬í•˜ì„¸ìš”.',
            priority: 'medium'
          });
        } else if (mealTiming === 'post_meal_1h') {
          recommendations.push({
            type: 'positive',
            message: 'ì‹í›„ ìš´ë™ì€ í˜ˆë‹¹ ìƒìŠ¹ì„ ì–µì œí•˜ëŠ” ë° íš¨ê³¼ì ì…ë‹ˆë‹¤.',
            priority: 'info'
          });
        }
        
        return recommendations;
      }

      // AI ê¸°ë°˜ ê°œì¸í™” ì¶”ì²œ
      async generatePersonalizedRecommendations(currentRecord, personalData) {
        const recommendations = [];
        
        // í˜ˆë‹¹ ìˆ˜ì¤€ë³„ ê°œì¸í™” ì¡°ì–¸
        if (currentRecord.glucose < 70) {
          recommendations.push({
            type: 'emergency',
            title: 'ğŸš¨ ì €í˜ˆë‹¹ ì‘ê¸‰ì¡°ì¹˜',
            message: 'ì¦‰ì‹œ í¬ë„ë‹¹ 15g ì„­ì·¨ í›„ 15ë¶„ ë’¤ ì¬ì¸¡ì •í•˜ì„¸ìš”. ì˜ì‹ì´ ì—†ìœ¼ë©´ ì‘ê¸‰ì‹¤(119)ë¡œ ì—°ë½í•˜ì„¸ìš”.',
            priority: 'critical'
          });
        } else if (currentRecord.glucose > 250) {
          recommendations.push({
            type: 'emergency',
            title: 'ğŸš¨ ê³ í˜ˆë‹¹ ì‘ê¸‰ìƒí™©',
            message: 'ì¼€í†¤ ê²€ì‚¬ë¥¼ ì‹¤ì‹œí•˜ê³  ë‹´ë‹¹ ì˜ë£Œì§„ì—ê²Œ ì¦‰ì‹œ ì—°ë½í•˜ì„¸ìš”. ì¶©ë¶„í•œ ìˆ˜ë¶„ì„ ì„­ì·¨í•˜ì„¸ìš”.',
            priority: 'critical'
          });
        }
        
        // ê°œì¸ íŒ¨í„´ ë¶„ì„ ê¸°ë°˜ ì¶”ì²œ
        if (personalData.records && personalData.records.length > 20) {
          const recentTrend = this.analyzeTrend(personalData.records.slice(-7));
          
          if (recentTrend.increasing) {
            recommendations.push({
              type: 'pattern',
              title: 'ğŸ“ˆ í˜ˆë‹¹ ìƒìŠ¹ íŒ¨í„´ ê°ì§€',
              message: 'ìµœê·¼ 7ì¼ê°„ í˜ˆë‹¹ì´ ìƒìŠ¹ ì¶”ì„¸ì…ë‹ˆë‹¤. ì‹ë‹¨ê³¼ ìš´ë™ íŒ¨í„´ì„ ì ê²€í•´ë³´ì„¸ìš”.',
              priority: 'high'
            });
          }
          
          // ìŒì‹ë³„ ê°œì¸ ë°˜ì‘ ë¶„ì„
          if (currentRecord.food) {
            const foodPattern = this.analyzeFoodPattern(currentRecord.food, personalData);
            if (foodPattern.riskLevel === 'high') {
              recommendations.push({
                type: 'food',
                title: 'ğŸ½ï¸ ê°œì¸ ìŒì‹ ë°˜ì‘ ì£¼ì˜',
                message: `${currentRecord.food}ì€(ëŠ”) ê·€í•˜ì—ê²Œ í‰ê·  ${foodPattern.avgGlucose}mg/dLì˜ í˜ˆë‹¹ ìƒìŠ¹ì„ ì¼ìœ¼í‚µë‹ˆë‹¤. ì¸ìŠë¦° ìš©ëŸ‰ ì¡°ì •ì„ ê³ ë ¤í•´ë³´ì„¸ìš”.`,
                priority: 'medium'
              });
            }
          }
        }
        
        // 2025ë…„ ëŒ€í•œë‹¹ë‡¨ë³‘í•™íšŒ ê°€ì´ë“œë¼ì¸ ê¸°ë°˜ ì¶”ì²œ
        const guidelines = this.getLatestGuidelines();
        recommendations.push(...guidelines);
        
        return recommendations;
      }

      analyzeTrend(recentRecords) {
        const glucoseValues = recentRecords.map(r => parseFloat(r.glucose));
        const trend = glucoseValues.slice(-3).reduce((sum, val) => sum + val, 0) / 3 -
                     glucoseValues.slice(0, 3).reduce((sum, val) => sum + val, 0) / 3;
        
        return {
          increasing: trend > 20,
          decreasing: trend < -20,
          stable: Math.abs(trend) <= 20,
          value: trend
        };
      }

      analyzeFoodPattern(food, personalData) {
        const foodRecords = personalData.records.filter(r => r.food === food);
        if (foodRecords.length < 3) {
          return { riskLevel: 'unknown', avgGlucose: 0 };
        }
        
        const avgGlucose = foodRecords.reduce((sum, r) => sum + parseFloat(r.postMealGlucose || r.glucose), 0) / foodRecords.length;
        
        return {
          riskLevel: avgGlucose > 200 ? 'high' : avgGlucose > 160 ? 'medium' : 'low',
          avgGlucose: Math.round(avgGlucose),
          count: foodRecords.length
        };
      }

      getLatestGuidelines() {
        return [
          {
            type: 'guideline',
            title: 'ğŸ“‹ 2025ë…„ ëŒ€í•œë‹¹ë‡¨ë³‘í•™íšŒ ê¶Œê³ ',
            message: 'ëª©í‘œ í˜ˆë‹¹: ì‹ì „ 80-130mg/dL, ì‹í›„ 80-180mg/dL. ìš´ë™ ì „ í˜ˆë‹¹ 100mg/dL ì´ìƒ ê¶Œì¥.',
            priority: 'info',
            source: 'ëŒ€í•œë‹¹ë‡¨ë³‘í•™íšŒ 2025'
          }
        ];
      }
    }

    // ìš´ë™ íƒ€ì´ë¨¸ í´ë˜ìŠ¤
    class ExerciseTimer {
      constructor() {
        this.startTime = null;
        this.endTime = null;
        this.isRunning = false;
        this.interval = null;
      }
      
      start() {
        this.startTime = new Date();
        this.isRunning = true;
        this.updateTimer();
        this.interval = setInterval(() => this.updateTimer(), 1000);
      }
      
      stop() {
        this.endTime = new Date();
        this.isRunning = false;
        if (this.interval) {
          clearInterval(this.interval);
          this.interval = null;
        }
      }
      
      getDuration() {
        if (!this.startTime) return 0;
        const endTime = this.endTime || new Date();
        return Math.floor((endTime - this.startTime) / 60000); // ë¶„ ë‹¨ìœ„
      }
      
      getFormattedTime() {
        const duration = this.getDuration();
        const hours = Math.floor(duration / 60);
        const minutes = duration % 60;
        return hours > 0 ? `${hours}:${minutes.toString().padStart(2, '0')}` : `${minutes}ë¶„`;
      }
      
      updateTimer() {
        const timerDisplay = document.getElementById('timerDisplay');
        if (timerDisplay) {
          timerDisplay.textContent = this.getFormattedTime();
        }
      }
    }

    // ì‚¬ìš©ì ê´€ë¦¬ ì‹œìŠ¤í…œ
    class UserManager {
      constructor() {
        this.currentUser = null;
        this.users = this.loadUsers();
      }

      loadUsers() {
        try {
          const stored = localStorage.getItem('dialife_users_v3');
          return stored ? JSON.parse(stored) : {};
        } catch (error) {
          console.warn('ì‚¬ìš©ì ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
          return {};
        }
      }

      saveUsers() {
        try {
          localStorage.setItem('dialife_users_v3', JSON.stringify(this.users));
        } catch (error) {
          console.warn('ì‚¬ìš©ì ë°ì´í„° ì €ì¥ ì‹¤íŒ¨:', error);
        }
      }

      register(userData) {
        const userId = this.generateUserId();
        const user = {
          id: userId,
          ...userData,
          createdAt: new Date().toISOString(),
          lastLogin: new Date().toISOString(),
          records: [],
          exerciseRecords: [], // ìš´ë™ ê¸°ë¡ ì¶”ê°€
          preferences: {
            targetGlucose: { min: 80, max: 180 },
            targetA1C: 7.0,
            insulinType: 'rapid',
            cgmEnabled: false,
            notifications: true,
            exerciseReminders: true // ìš´ë™ ì•Œë¦¼ ì¶”ê°€
          },
          personalizedData: {
            totalRecords: 0,
            totalExerciseRecords: 0, // ìš´ë™ ê¸°ë¡ ìˆ˜ ì¶”ê°€
            avgGlucose: 0,
            timeInRange: 0,
            avgA1C: 0,
            personalICR: 15,
            personalISF: 50,
            foodReactions: {},
            exerciseReactions: {}, // ìš´ë™ë³„ í˜ˆë‹¹ ë°˜ì‘ ì¶”ê°€
            timePatterns: {},
            exercisePatterns: {}, // ìš´ë™ ì‹œê°„ëŒ€ë³„ íŒ¨í„´ ì¶”ê°€
            successfulPatterns: [],
            riskFactors: []
          },
          medicalInfo: {
            diabetesType: '1í˜•',
            diagnosisDate: userData.diagnosisYear ? `${userData.diagnosisYear}-01-01` : null,
            currentMedications: [],
            allergies: [],
            emergencyContacts: [],
            exerciseRestrictions: [] // ìš´ë™ ì œí•œì‚¬í•­ ì¶”ê°€
          }
        };
        
        this.users[userId] = user;
        this.saveUsers();
        return user;
      }

      login(username, password) {
        const user = Object.values(this.users).find(u => 
          u.username === username && u.password === password
        );
        
        if (user) {
          user.lastLogin = new Date().toISOString();
          this.currentUser = user;
          this.saveUsers();
          return user;
        }
        return null;
      }

      getCurrentUser() {
        return this.currentUser;
      }

      updateUserData(updates) {
        if (this.currentUser) {
          Object.assign(this.currentUser, updates);
          this.users[this.currentUser.id] = this.currentUser;
          this.saveUsers();
        }
      }

      addRecord(record) {
        if (this.currentUser) {
          this.currentUser.records.push(record);
          this.updatePersonalizedData();
          this.saveUsers();
        }
      }

      addExerciseRecord(exerciseRecord) {
        if (this.currentUser) {
          this.currentUser.exerciseRecords.push(exerciseRecord);
          this.updatePersonalizedData();
          this.saveUsers();
        }
      }

      deleteRecord(recordId) {
        if (this.currentUser) {
          this.currentUser.records = this.currentUser.records.filter(r => r.id !== recordId);
          this.updatePersonalizedData();
          this.saveUsers();
        }
      }

      deleteExerciseRecord(recordId) {
        if (this.currentUser) {
          this.currentUser.exerciseRecords = this.currentUser.exerciseRecords.filter(r => r.id !== recordId);
          this.updatePersonalizedData();
          this.saveUsers();
        }
      }

      updatePersonalizedData() {
        if (!this.currentUser) return;

        const records = this.currentUser.records;
        const exerciseRecords = this.currentUser.exerciseRecords || [];
        const personalizedData = this.currentUser.personalizedData;

        // ê¸°ë³¸ í†µê³„ ì—…ë°ì´íŠ¸
        personalizedData.totalRecords = records.length;
        personalizedData.totalExerciseRecords = exerciseRecords.length;
        
        if (records.length > 0) {
          const glucoseValues = records.map(r => parseFloat(r.glucose || 0));
          personalizedData.avgGlucose = Math.round(
            glucoseValues.reduce((sum, val) => sum + val, 0) / glucoseValues.length
          );

          // ëª©í‘œ ë²”ìœ„ ì‹œê°„ ê³„ì‚° (TIR: Time In Range)
          const targetRange = records.filter(r => {
            const glucose = parseFloat(r.glucose);
            return glucose >= 80 && glucose <= 180;
          });
          personalizedData.timeInRange = Math.round((targetRange.length / records.length) * 100);

          // ê°œì¸í™”ëœ ì¸ìŠë¦° ë¹„ìœ¨ í•™ìŠµ
          this.learnPersonalizedRatios();

          // ìŒì‹ë³„ ë°˜ì‘ íŒ¨í„´ ë¶„ì„
          this.analyzeFoodReactions();

          // ì‹œê°„ëŒ€ë³„ íŒ¨í„´ ë¶„ì„
          this.analyzeTimePatterns();
        }

        // ìš´ë™ë³„ ë°˜ì‘ íŒ¨í„´ ë¶„ì„
        if (exerciseRecords.length > 0) {
          this.analyzeExerciseReactions();
          this.analyzeExerciseTimePatterns();
        }
      }

      analyzeExerciseReactions() {
        const exerciseRecords = this.currentUser.exerciseRecords;
        const exerciseReactions = {};

        exerciseRecords.forEach(record => {
          const exerciseType = record.exerciseType;
          if (!exerciseType) return;

          if (!exerciseReactions[exerciseType]) {
            exerciseReactions[exerciseType] = {
              count: 0,
              avgDuration: 0,
              avgGlucoseChange: 0,
              glucoseChanges: [],
              avgCaloriesBurned: 0,
              safetyLevel: 'unknown',
              mealTimingPatterns: {}
            };
          }

          const reaction = exerciseReactions[exerciseType];
          reaction.count++;
          
          if (record.duration) {
            reaction.avgDuration = Math.round(
              (reaction.avgDuration * (reaction.count - 1) + parseFloat(record.duration)) / reaction.count
            );
          }

          if (record.preExerciseGlucose && record.postExerciseGlucose) {
            const change = parseFloat(record.postExerciseGlucose) - parseFloat(record.preExerciseGlucose);
            reaction.glucoseChanges.push(change);
            reaction.avgGlucoseChange = Math.round(
              reaction.glucoseChanges.reduce((a, b) => a + b, 0) / reaction.glucoseChanges.length
            );
          }

          if (record.caloriesBurned) {
            reaction.avgCaloriesBurned = Math.round(
              (reaction.avgCaloriesBurned * (reaction.count - 1) + parseFloat(record.caloriesBurned)) / reaction.count
            );
          }

          // ì‹ì‚¬ íƒ€ì´ë°ë³„ íŒ¨í„´ ë¶„ì„
          const mealTiming = record.mealTiming || 'unknown';
          if (!reaction.mealTimingPatterns[mealTiming]) {
            reaction.mealTimingPatterns[mealTiming] = { count: 0, avgGlucoseChange: 0 };
          }
          reaction.mealTimingPatterns[mealTiming].count++;

          // ì•ˆì „ë„ í‰ê°€
          if (Math.abs(reaction.avgGlucoseChange) < 30) {
            reaction.safetyLevel = 'safe';
          } else if (Math.abs(reaction.avgGlucoseChange) > 60) {
            reaction.safetyLevel = 'high_risk';
          } else {
            reaction.safetyLevel = 'moderate';
          }
        });

        this.currentUser.personalizedData.exerciseReactions = exerciseReactions;
      }

      analyzeExerciseTimePatterns() {
        const exerciseRecords = this.currentUser.exerciseRecords;
        const exerciseTimePatterns = {};

        exerciseRecords.forEach(record => {
          const hour = new Date(record.startTime || record.timestamp).getHours();
          const timeSlot = this.getTimeSlot(hour);
          
          if (!exerciseTimePatterns[timeSlot]) {
            exerciseTimePatterns[timeSlot] = {
              count: 0,
              avgDuration: 0,
              avgGlucoseChange: 0,
              commonExercises: {}
            };
          }

          const pattern = exerciseTimePatterns[timeSlot];
          pattern.count++;

          if (record.duration) {
            pattern.avgDuration = Math.round(
              (pattern.avgDuration * (pattern.count - 1) + parseFloat(record.duration)) / pattern.count
            );
          }

          if (record.preExerciseGlucose && record.postExerciseGlucose) {
            const change = parseFloat(record.postExerciseGlucose) - parseFloat(record.preExerciseGlucose);
            pattern.avgGlucoseChange = Math.round(
              (pattern.avgGlucoseChange * (pattern.count - 1) + change) / pattern.count
            );
          }

          // ì‹œê°„ëŒ€ë³„ ì£¼ìš” ìš´ë™ ì¢…ëª©
          const exerciseType = record.exerciseType;
          if (exerciseType) {
            pattern.commonExercises[exerciseType] = (pattern.commonExercises[exerciseType] || 0) + 1;
          }
        });

        this.currentUser.personalizedData.exercisePatterns = exerciseTimePatterns;
      }

      learnPersonalizedRatios() {
        const records = this.currentUser.records;
        const successfulRecords = records.filter(r => {
          return r.postMealGlucose && 
                 r.postMealGlucose >= 80 && 
                 r.postMealGlucose <= 180 &&
                 r.carbs > 0 && r.insulin > 0;
        });

        if (successfulRecords.length >= 10) {
          const avgICR = successfulRecords.reduce((sum, r) => {
            return sum + (r.carbs / r.insulin);
          }, 0) / successfulRecords.length;

          this.currentUser.personalizedData.personalICR = Math.round(avgICR * 10) / 10;
        }
      }

      analyzeFoodReactions() {
        const records = this.currentUser.records;
        const foodReactions = {};

        records.forEach(record => {
          const food = record.food;
          if (!food) return;

          if (!foodReactions[food]) {
            foodReactions[food] = {
              count: 0,
              avgGlucose: 0,
              glucoseValues: [],
              avgInsulin: 0,
              avgCarbs: 0,
              riskLevel: 'unknown'
            };
          }

          const reaction = foodReactions[food];
          reaction.count++;
          reaction.glucoseValues.push(parseFloat(record.postMealGlucose || record.glucose || 0));
          reaction.avgGlucose = Math.round(
            reaction.glucoseValues.reduce((a, b) => a + b, 0) / reaction.glucoseValues.length
          );
          reaction.avgInsulin = Math.round((reaction.avgInsulin * (reaction.count - 1) + parseFloat(record.insulin || 0)) / reaction.count * 10) / 10;
          reaction.avgCarbs = Math.round((reaction.avgCarbs * (reaction.count - 1) + parseFloat(record.carbs || 0)) / reaction.count);
          
          // ìœ„í—˜ë„ í‰ê°€
          reaction.riskLevel = reaction.avgGlucose > 200 ? 'high' : 
                              reaction.avgGlucose > 160 ? 'medium' : 'low';
        });

        this.currentUser.personalizedData.foodReactions = foodReactions;
      }

      analyzeTimePatterns() {
        const records = this.currentUser.records;
        const timePatterns = {};

        records.forEach(record => {
          const hour = new Date(record.timestamp).getHours();
          const timeSlot = this.getTimeSlot(hour);
          
          if (!timePatterns[timeSlot]) {
            timePatterns[timeSlot] = {
              count: 0,
              avgGlucose: 0,
              records: []
            };
          }

          timePatterns[timeSlot].records.push(parseFloat(record.glucose || 0));
          timePatterns[timeSlot].count++;
          timePatterns[timeSlot].avgGlucose = Math.round(
            timePatterns[timeSlot].records.reduce((a, b) => a + b, 0) / 
            timePatterns[timeSlot].records.length
          );
        });

        this.currentUser.personalizedData.timePatterns = timePatterns;
      }

      getTimeSlot(hour) {
        if (hour >= 6 && hour < 12) return 'ì•„ì¹¨';
        if (hour >= 12 && hour < 18) return 'ì ì‹¬';
        if (hour >= 18 && hour < 22) return 'ì €ë…';
        return 'ë°¤';
      }

      generateUserId() {
        return 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
      }
    }

    // ê¸€ë¡œë²Œ ë³€ìˆ˜ë“¤
    let userManager = new UserManager();
    let aiEngine = new PersonalizedAIEngine();
    let exerciseTimer = new ExerciseTimer();
    let currentTab = 'dashboard';
    let calculationResult = null;

    // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
    function calculateCarbs(food, amount) {
      if (!food || !amount || !KOREAN_FOOD_DATABASE[food]) return 0;
      const numAmount = parseFloat(amount);
      if (isNaN(numAmount)) return 0;
      return Math.round((KOREAN_FOOD_DATABASE[food].carbs * numAmount) / 100);
    }

    function getGlucoseColor(glucose) {
      const val = parseFloat(glucose);
      if (val < 70) return '#ef4444'; // ì €í˜ˆë‹¹ - ë¹¨ê°•
      if (val > 180) return '#f59e0b'; // ê³ í˜ˆë‹¹ - ì£¼í™©
      return '#10b981'; // ì •ìƒ - ì´ˆë¡
    }

    function getTrendClass(glucose) {
      if (glucose <= 140) return 'trend-good';
      if (glucose <= 180) return 'trend-warning';
      return 'trend-danger';
    }

    function formatDate(timestamp) {
      return new Date(timestamp).toLocaleString('ko-KR', {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    }

    function searchFood(query) {
      if (!query || query.length < 1) return [];
      
      const results = Object.keys(KOREAN_FOOD_DATABASE)
        .filter(food => food.includes(query))
        .map(food => ({
          name: food,
          data: KOREAN_FOOD_DATABASE[food]
        }))
        .slice(0, 8);
      
      return results;
    }

    function searchExercise(query) {
      if (!query || query.length < 1) return [];
      
      const results = Object.keys(EXERCISE_DATABASE)
        .filter(exercise => exercise.includes(query))
        .map(exercise => ({
          name: exercise,
          data: EXERCISE_DATABASE[exercise]
        }))
        .slice(0, 8);
      
      return results;
    }

    // ì•± ì´ˆê¸°í™”
    function initApp() {
      const currentUser = userManager.getCurrentUser();
      
      if (!currentUser) {
        renderAuthScreen();
      } else {
        renderMainApp();
      }
    }

    // ì¸ì¦ í™”ë©´ ë Œë”ë§
    function renderAuthScreen() {
      document.getElementById('app').innerHTML = `
        <div class="auth-container">
          <div class="auth-card">
            <div class="auth-header">
              <h1>ğŸš DiaLife Pro</h1>
              <p>ê°œì¸í™”ëœ 1í˜•ë‹¹ë‡¨ ê´€ë¦¬ ì‹œìŠ¤í…œ</p>
            </div>
            
            <div id="authContent">
              <div id="loginForm">
                <h3 style="margin-bottom: 1rem; color: #1f2937;">ë¡œê·¸ì¸</h3>
                <div class="form-group" style="margin-bottom: 1rem;">
                  <label for="loginUsername">ì‚¬ìš©ìëª…</label>
                  <input type="text" id="loginUsername" required placeholder="ì‚¬ìš©ìëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                <div class="form-group" style="margin-bottom: 1.5rem;">
                  <label for="loginPassword">ë¹„ë°€ë²ˆí˜¸</label>
                  <input type="password" id="loginPassword" required placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                <button onclick="handleLogin()" class="btn btn-primary btn-full">ë¡œê·¸ì¸</button>
                
                <p style="text-align: center; margin: 1.5rem 0; color: #6b7280;">ë˜ëŠ”</p>
                
                <button onclick="showRegisterForm()" class="btn btn-success btn-full">
                  ìƒˆ ê³„ì • ë§Œë“¤ê¸°
                </button>
                
                <div style="margin-top: 2rem; padding: 1rem; background: rgba(255, 255, 255, 0.1); border-radius: 0.5rem;">
                  <h4 style="margin-bottom: 0.5rem; color: #1f2937;">âš•ï¸ ì˜ë£Œì  ì•ˆì „ì„± ê³ ì§€</h4>
                  <p style="font-size: 0.875rem; color: #6b7280; line-height: 1.6;">
                    ë³¸ ì•±ì€ ì˜ë£Œì§„ì˜ ì§„ë£Œë¥¼ ëŒ€ì²´í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ëª¨ë“  ì¹˜ë£Œ ê²°ì •ì€ ë‹´ë‹¹ ì˜ë£Œì§„ê³¼ ìƒì˜í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤. 
                    ì‘ê¸‰ìƒí™© ì‹œ ì¦‰ì‹œ 119 ë˜ëŠ” ë‹´ë‹¹ ë³‘ì›ì— ì—°ë½í•˜ì„¸ìš”.
                  </p>
                </div>
              </div>
              
              <div id="registerForm" class="hidden">
                <h3 style="margin-bottom: 1rem; color: #1f2937;">íšŒì›ê°€ì…</h3>
                <div class="form-grid">
                  <div class="form-group">
                    <label for="regUsername">ì‚¬ìš©ìëª… *</label>
                    <input type="text" id="regUsername" required placeholder="ì‚¬ìš©ìëª…">
                  </div>
                  <div class="form-group">
                    <label for="regPassword">ë¹„ë°€ë²ˆí˜¸ *</label>
                    <input type="password" id="regPassword" required placeholder="ë¹„ë°€ë²ˆí˜¸">
                  </div>
                  <div class="form-group">
                    <label for="regName">ì´ë¦„ *</label>
                    <input type="text" id="regName" required placeholder="ì‹¤ëª…">
                  </div>
                  <div class="form-group">
                    <label for="regAge">ë‚˜ì´</label>
                    <input type="number" id="regAge" placeholder="ë‚˜ì´" min="1" max="120">
                  </div>
                  <div class="form-group">
                    <label for="regWeight">ì²´ì¤‘ (kg)</label>
                    <input type="number" id="regWeight" placeholder="ì²´ì¤‘" step="0.1">
                  </div>
                  <div class="form-group">
                    <label for="regHeight">ì‹ ì¥ (cm)</label>
                    <input type="number" id="regHeight" placeholder="ì‹ ì¥">
                  </div>
                </div>
                
                <div class="form-group" style="margin: 1rem 0;">
                  <label for="regDiagnosis">1í˜•ë‹¹ë‡¨ ì§„ë‹¨ ì—°ë„</label>
                  <input type="number" id="regDiagnosis" placeholder="YYYY" min="1950" max="2025">
                </div>
                
                <div class="form-group" style="margin: 1rem 0;">
                  <label for="emergencyContact">ì‘ê¸‰ ì—°ë½ì²˜</label>
                  <input type="tel" id="emergencyContact" placeholder="010-0000-0000">
                </div>
                
                <button onclick="handleRegister()" class="btn btn-success btn-full" style="margin-bottom: 1rem;">
                  íšŒì›ê°€ì… ì™„ë£Œ
                </button>
                
                <button onclick="showLoginForm()" class="btn btn-primary btn-full">
                  ë¡œê·¸ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°
                </button>
                
                <div style="margin-top: 1rem; padding: 1rem; background: rgba(245, 158, 11, 0.1); border: 1px solid #f59e0b; border-radius: 0.5rem;">
                  <p style="font-size: 0.875rem; color: #92400e;">
                    âš ï¸ íšŒì›ê°€ì… ì‹œ ê°œì¸ì •ë³´ ìˆ˜ì§‘ì— ë™ì˜í•˜ëŠ” ê²ƒìœ¼ë¡œ ê°„ì£¼ë©ë‹ˆë‹¤. ì˜ë£Œ ë°ì´í„°ëŠ” ì•”í˜¸í™”ë˜ì–´ ì•ˆì „í•˜ê²Œ ë³´ê´€ë©ë‹ˆë‹¤.
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    // ì¸ì¦ ê´€ë ¨ í•¨ìˆ˜ë“¤
    function showRegisterForm() {
      document.getElementById('loginForm').classList.add('hidden');
      document.getElementById('registerForm').classList.remove('hidden');
    }

    function showLoginForm() {
      document.getElementById('registerForm').classList.add('hidden');
      document.getElementById('loginForm').classList.remove('hidden');
    }

    function handleLogin() {
      const username = document.getElementById('loginUsername').value;
      const password = document.getElementById('loginPassword').value;
      
      if (!username || !password) {
        alert('ì‚¬ìš©ìëª…ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
        return;
      }
      
      const user = userManager.login(username, password);
      
      if (user) {
        renderMainApp();
      } else {
        alert('ë¡œê·¸ì¸ ì‹¤íŒ¨. ì‚¬ìš©ìëª…ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.');
      }
    }

    function handleRegister() {
      const username = document.getElementById('regUsername').value;
      const password = document.getElementById('regPassword').value;
      const name = document.getElementById('regName').value;
      const age = document.getElementById('regAge').value;
      const weight = document.getElementById('regWeight').value;
      const height = document.getElementById('regHeight').value;
      const diagnosisYear = document.getElementById('regDiagnosis').value;
      const emergencyContact = document.getElementById('emergencyContact').value;
      
      if (!username || !password || !name) {
        alert('í•„ìˆ˜ ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.');
        return;
      }
      
      // ì¤‘ë³µ ì‚¬ìš©ìëª… í™•ì¸
      const existingUser = Object.values(userManager.users).find(u => u.username === username);
      if (existingUser) {
        alert('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì‚¬ìš©ìëª…ì…ë‹ˆë‹¤.');
        return;
      }
      
      const userData = {
        username,
        password,
        name,
        age: age ? parseInt(age) : null,
        weight: weight ? parseFloat(weight) : null,
        height: height ? parseInt(height) : null,
        diagnosisYear: diagnosisYear ? parseInt(diagnosisYear) : null,
        emergencyContact: emergencyContact || null
      };
      
      const user = userManager.register(userData);
      userManager.currentUser = user;
      
      alert('íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
      renderMainApp();
    }

    function logout() {
      userManager.currentUser = null;
      renderAuthScreen();
    }

    // ë©”ì¸ ì•± ë Œë”ë§
    function renderMainApp() {
      const user = userManager.getCurrentUser();
      const insights = getPersonalizedInsights();
      
      document.getElementById('app').innerHTML = `
        <div class="container">
          <header class="header">
            <div class="header-left">
              <h1>ğŸš DiaLife Pro AI</h1>
              <div class="welcome">ì•ˆë…•í•˜ì„¸ìš”, ${user.name}ë‹˜! ê°œì¸í™”ëœ ë‹¹ë‡¨ ê´€ë¦¬ë¥¼ ì‹œì‘í•˜ì„¸ìš”.</div>
            </div>
            <div class="header-right">
              <div class="user-info">
                <div class="user-name">${user.name} (${user.age || 'ë¯¸ì„¤ì •'}ì„¸)</div>
                <div class="user-stats">
                  í˜ˆë‹¹ ${user.personalizedData.totalRecords}ê°œ â€¢ ìš´ë™ ${user.personalizedData.totalExerciseRecords || 0}ê°œ â€¢
                  í‰ê·  í˜ˆë‹¹ ${user.personalizedData.avgGlucose || 0}mg/dL â€¢
                  TIR ${user.personalizedData.timeInRange || 0}%
                </div>
              </div>
              <button onclick="logout()" class="btn btn-logout">
                ğŸšª ë¡œê·¸ì•„ì›ƒ
              </button>
            </div>
          </header>

          ${insights.length > 0 ? `
          <div class="personalized-insights">
            <h2 style="margin-bottom: 1rem; color: #0c4a6e;">
              ğŸ¯ ${user.name}ë‹˜ì„ ìœ„í•œ AI ê°œì¸í™” ì¸ì‚¬ì´íŠ¸
            </h2>
            <div class="insight-grid">
              ${insights.map(insight => `
                <div class="insight-card">
                  <div class="insight-title">${insight.title}</div>
                  <p style="margin-bottom: 0.5rem; font-size: 0.9rem;">${insight.description}</p>
                  <p style="font-size: 0.85rem; color: #059669; font-weight: 500;">ğŸ’¡ ${insight.recommendation}</p>
                </div>
              `).join('')}
            </div>
          </div>
          ` : ''}

          <div class="tab-container">
            <div class="tab-buttons">
              <button class="tab-button ${currentTab === 'dashboard' ? 'active' : ''}" onclick="switchTab('dashboard')">
                ğŸ“Š ëŒ€ì‹œë³´ë“œ
              </button>
              <button class="tab-button ${currentTab === 'calculator' ? 'active' : ''}" onclick="switchTab('calculator')">
                ğŸ§® ì¸ìŠë¦° ê³„ì‚°
              </button>
              <button class="tab-button ${currentTab === 'record' ? 'active' : ''}" onclick="switchTab('record')">
                â• ê¸°ë¡ ì¶”ê°€
              </button>
              <button class="tab-button ${currentTab === 'exercise' ? 'active' : ''}" onclick="switchTab('exercise')">
                ğŸƒâ€â™‚ï¸ ìš´ë™ ê´€ë¦¬
              </button>
              <button class="tab-button ${currentTab === 'analysis' ? 'active' : ''}" onclick="switchTab('analysis')">
                ğŸ“ˆ ê°œì¸ ë¶„ì„
              </button>
              <button class="tab-button ${currentTab === 'food' ? 'active' : ''}" onclick="switchTab('food')">
                ğŸ½ï¸ ìŒì‹ íŒ¨í„´
              </button>
              <button class="tab-button ${currentTab === 'emergency' ? 'active' : ''}" onclick="switchTab('emergency')">
                ğŸš¨ ì‘ê¸‰ìƒí™©
              </button>
              <button class="tab-button ${currentTab === 'profile' ? 'active' : ''}" onclick="switchTab('profile')">
                âš™ï¸ ì„¤ì •
              </button>
            </div>
          </div>

          <div id="tabContent"></div>
          
          <footer style="margin-top: 3rem; padding: 2rem; background: rgba(255, 255, 255, 0.1); border-radius: 1rem; color: white; text-align: center;">
            <p style="margin-bottom: 0.5rem;">Â© 2025 DiaLife Pro - 2025ë…„ ëŒ€í•œë‹¹ë‡¨ë³‘í•™íšŒ ê°€ì´ë“œë¼ì¸ ì¤€ìˆ˜</p>
            <p style="font-size: 0.875rem; opacity: 0.8;">ì‹í’ˆì˜ì•½í’ˆì•ˆì „ì²˜ ì˜ë£Œê¸°ê¸° í—ˆê°€ ê¸°ì¤€ â€¢ ê°œì¸ì •ë³´ë³´í˜¸ë²• ì™„ì „ ì¤€ìˆ˜</p>
            <p style="font-size: 0.75rem; margin-top: 1rem; opacity: 0.7;">
              ì‘ê¸‰ìƒí™©: 119 | ì €í˜ˆë‹¹: í¬ë„ë‹¹ 15g ì„­ì·¨ | ê³ í˜ˆë‹¹: ì¦‰ì‹œ ì˜ë£Œì§„ ì—°ë½ | ìš´ë™ ì „ í˜ˆë‹¹ 100mg/dL ì´ìƒ ê¶Œì¥
            </p>
          </footer>
        </div>
      `;

      renderTabContent();
    }

    function getPersonalizedInsights() {
      const user = userManager.getCurrentUser();
      if (!user || (user.records.length < 3 && (user.exerciseRecords || []).length < 2)) return [];

      const insights = [];
      const data = user.personalizedData;
      const records = user.records;
      const exerciseRecords = user.exerciseRecords || [];

      // ëª©í‘œ ë²”ìœ„ ì‹œê°„(TIR) ë¶„ì„
      if (data.timeInRange < 70) {
        insights.push({
          title: 'ğŸ“Š ëª©í‘œ ë²”ìœ„ ì‹œê°„ ê°œì„  í•„ìš”',
          description: `í˜„ì¬ TIR ${data.timeInRange}%ë¡œ ëª©í‘œì¸ 70% ì´í•˜ì…ë‹ˆë‹¤.`,
          recommendation: 'ì¸ìŠë¦° ìš©ëŸ‰ ì¡°ì •ê³¼ ê·œì¹™ì ì¸ ìš´ë™ì„ í†µí•´ ê°œì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.'
        });
      } else if (data.timeInRange >= 80) {
        insights.push({
          title: 'ğŸ‰ ìš°ìˆ˜í•œ í˜ˆë‹¹ ê´€ë¦¬',
          description: `TIR ${data.timeInRange}%ë¡œ ë§¤ìš° ì¢‹ì€ ê´€ë¦¬ ìƒíƒœì…ë‹ˆë‹¤.`,
          recommendation: 'í˜„ì¬ íŒ¨í„´ì„ ìœ ì§€í•˜ì„¸ìš”!'
        });
      }

      // ìš´ë™ íŒ¨í„´ ë¶„ì„
      if (exerciseRecords.length >= 5) {
        const avgWeeklyExercise = exerciseRecords.filter(r => {
          const recordDate = new Date(r.timestamp);
          const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
          return recordDate >= weekAgo;
        }).length;

        if (avgWeeklyExercise < 3) {
          insights.push({
            title: 'ğŸƒâ€â™‚ï¸ ìš´ë™ íšŸìˆ˜ ë¶€ì¡±',
            description: `ì£¼ê°„ ìš´ë™ íšŸìˆ˜ê°€ ${avgWeeklyExercise}íšŒë¡œ ê¶Œì¥ëŸ‰ë³´ë‹¤ ì ìŠµë‹ˆë‹¤.`,
            recommendation: 'ì£¼ 3-4íšŒ ê·œì¹™ì ì¸ ìš´ë™ìœ¼ë¡œ í˜ˆë‹¹ ì•ˆì •ì„±ì„ ë†’ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.'
          });
        } else if (avgWeeklyExercise >= 4) {
          insights.push({
            title: 'ğŸ’ª ìš°ìˆ˜í•œ ìš´ë™ íŒ¨í„´',
            description: `ì£¼ê°„ ìš´ë™ íšŸìˆ˜ê°€ ${avgWeeklyExercise}íšŒë¡œ ë§¤ìš° ì¢‹ìŠµë‹ˆë‹¤.`,
            recommendation: 'ê·œì¹™ì ì¸ ìš´ë™ì´ í˜ˆë‹¹ ê´€ë¦¬ì— ë„ì›€ì´ ë˜ê³  ìˆìŠµë‹ˆë‹¤!'
          });
        }
      }

      // ìµœê·¼ 7ì¼ íŠ¸ë Œë“œ ë¶„ì„
      if (records.length >= 7) {
        const recentRecords = records.slice(-7);
        const avgRecent = recentRecords.reduce((sum, r) => sum + parseFloat(r.glucose || 0), 0) / recentRecords.length;
        const avgOverall = data.avgGlucose;
        
        if (avgRecent > avgOverall + 20) {
          insights.push({
            title: 'âš ï¸ ìµœê·¼ í˜ˆë‹¹ ìƒìŠ¹ ì£¼ì˜',
            description: `ìµœê·¼ 7ì¼ í‰ê·  í˜ˆë‹¹ì´ ${Math.round(avgRecent)}mg/dLë¡œ ì „ì²´ í‰ê· ë³´ë‹¤ ë†’ìŠµë‹ˆë‹¤.`,
            recommendation: 'ì‹ë‹¨ê³¼ ìš´ë™ íŒ¨í„´ì„ ì ê²€í•˜ê³  ì˜ë£Œì§„ê³¼ ìƒë‹´í•˜ì„¸ìš”.'
          });
        }
      }

      // ìš´ë™-í˜ˆë‹¹ ìƒê´€ê´€ê³„ ë¶„ì„
      if (data.exerciseReactions && Object.keys(data.exerciseReactions).length > 0) {
        const bestExercise = Object.entries(data.exerciseReactions)
          .filter(([exercise, reaction]) => reaction.safetyLevel === 'safe' && reaction.count >= 3)
          .sort((a, b) => Math.abs(b[1].avgGlucoseChange) - Math.abs(a[1].avgGlucoseChange))[0];

        if (bestExercise) {
          insights.push({
            title: 'ğŸ† ìµœì  ìš´ë™ íŒ¨í„´ ë°œê²¬',
            description: `${bestExercise[0]}ì´(ê°€) í˜ˆë‹¹ ì¡°ì ˆì— ê°€ì¥ íš¨ê³¼ì ì…ë‹ˆë‹¤.`,
            recommendation: `í‰ê·  ${Math.abs(bestExercise[1].avgGlucoseChange)}mg/dL ê°œì„  íš¨ê³¼ê°€ ìˆì–´ ì§€ì†í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.`
          });
        }
      }

      return insights.slice(0, 3);
    }

    function switchTab(tabName) {
      currentTab = tabName;
      renderMainApp();
    }

    // íƒ­ ì»¨í…ì¸  ë Œë”ë§
    function renderTabContent() {
      const container = document.getElementById('tabContent');
      const user = userManager.getCurrentUser();
      
      switch (currentTab) {
        case 'dashboard':
          renderDashboard(container, user);
          break;
        case 'calculator':
          renderCalculator(container, user);
          break;
        case 'record':
          renderRecordForm(container, user);
          break;
        case 'exercise':
          renderExercise(container, user);
          break;
        case 'analysis':
          renderAnalysis(container, user);
          break;
        case 'food':
          renderFoodPatterns(container, user);
          break;
        case 'emergency':
          renderEmergency(container, user);
          break;
        case 'profile':
          renderProfile(container, user);
          break;
      }
    }

    function renderDashboard(container, user) {
      const data = user.personalizedData;
      const recentRecords = user.records.slice(-8);
      const recentExercise = (user.exerciseRecords || []).slice(-5);
      
      container.innerHTML = `
        <div class="stats-dashboard">
          <div class="stat-card">
            <div class="stat-value">${data.avgGlucose || 0}</div>
            <div class="stat-label">í‰ê·  í˜ˆë‹¹ (mg/dL)</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">${data.timeInRange || 0}%</div>
            <div class="stat-label">ëª©í‘œ ë²”ìœ„ ì‹œê°„ (TIR)</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">${data.totalRecords}</div>
            <div class="stat-label">í˜ˆë‹¹ ê¸°ë¡ ìˆ˜</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">${data.totalExerciseRecords || 0}</div>
            <div class="stat-label">ìš´ë™ ê¸°ë¡ ìˆ˜</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">${data.personalICR || 15}</div>
            <div class="stat-label">ê°œì¸ ICR (g/ë‹¨ìœ„)</div>
          </div>
        </div>

        <div class="main-grid">
          <div class="card">
            <h2>ğŸ“‹ ìµœê·¼ í˜ˆë‹¹ ê¸°ë¡</h2>
            <div id="recentRecords">
              ${recentRecords.length === 0 ? 
                '<p style="color: #6b7280; text-align: center; padding: 2rem;">ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤. ì²« ê¸°ë¡ì„ ì¶”ê°€í•´ë³´ì„¸ìš”!</p>' :
                recentRecords.reverse().map(record => `
                  <div class="pattern-item">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                      <strong>${record.food || 'ê¸°ë¡'}</strong>
                      <span style="color: ${getGlucoseColor(record.glucose)}; font-weight: 600;">
                        ${record.glucose} mg/dL
                      </span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                      <div style="font-size: 0.875rem; color: #6b7280;">
                        íƒ„ìˆ˜í™”ë¬¼ ${record.carbs || 0}g â€¢ ì¸ìŠë¦° ${record.insulin || 0}ë‹¨ìœ„ â€¢ 
                        ${formatDate(record.timestamp).split(' ')[0]}
                      </div>
                      <button onclick="deleteRecord(${record.id})" class="btn btn-danger btn-small">ì‚­ì œ</button>
                    </div>
                  </div>
                `).join('')
              }
            </div>
          </div>

          <div class="card">
            <h2>ğŸƒâ€â™‚ï¸ ìµœê·¼ ìš´ë™ ê¸°ë¡</h2>
            <div>
              ${recentExercise.length === 0 ? 
                '<p style="color: #6b7280; text-align: center; padding: 2rem;">ì•„ì§ ìš´ë™ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>' :
                recentExercise.reverse().map(record => `
                  <div class="exercise-item">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                      <strong>${record.exerciseType || 'ìš´ë™'}</strong>
                      <span style="color: #d97706; font-weight: 600;">
                        ${record.duration || 0}ë¶„
                      </span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                      <div style="font-size: 0.875rem; color: #6b7280;">
                        ${record.preExerciseGlucose ? `ìš´ë™ì „ ${record.preExerciseGlucose}mg/dL` : ''} 
                        ${record.postExerciseGlucose ? `â†’ ìš´ë™í›„ ${record.postExerciseGlucose}mg/dL` : ''} â€¢ 
                        ${formatDate(record.timestamp).split(' ')[0]}
                      </div>
                      <button onclick="deleteExerciseRecord(${record.id})" class="btn btn-danger btn-small">ì‚­ì œ</button>
                    </div>
                  </div>
                `).join('')
              }
            </div>
          </div>
        </div>

        <div class="card full-width">
          <h2>â° ì‹œê°„ëŒ€ë³„ íŒ¨í„´ ë¶„ì„</h2>
          <div class="main-grid">
            <div>
              <h3 style="margin-bottom: 1rem;">í˜ˆë‹¹ íŒ¨í„´</h3>
              ${Object.entries(data.timePatterns).length === 0 ? 
                '<p style="color: #6b7280;">ì¶©ë¶„í•œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>' :
                Object.entries(data.timePatterns).map(([timeSlot, pattern]) => `
                  <div class="pattern-item">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                      <div>
                        <strong>${timeSlot}</strong>
                        <div style="font-size: 0.875rem; color: #6b7280;">${pattern.count}íšŒ ê¸°ë¡</div>
                      </div>
                      <div style="text-align: right;">
                        <div style="font-size: 1.25rem; font-weight: 600; color: ${getGlucoseColor(pattern.avgGlucose)};">
                          ${pattern.avgGlucose} mg/dL
                        </div>
                      </div>
                    </div>
                  </div>
                `).join('')
              }
            </div>
            
            <div>
              <h3 style="margin-bottom: 1rem;">ìš´ë™ íŒ¨í„´</h3>
              ${Object.entries(data.exercisePatterns || {}).length === 0 ? 
                '<p style="color: #6b7280;">ì¶©ë¶„í•œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>' :
                Object.entries(data.exercisePatterns).map(([timeSlot, pattern]) => `
                  <div class="exercise-item">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                      <div>
                        <strong>${timeSlot}</strong>
                        <div style="font-size: 0.875rem; color: #6b7280;">
                          ${pattern.count}íšŒ ìš´ë™ â€¢ í‰ê·  ${pattern.avgDuration}ë¶„
                        </div>
                      </div>
                      <div style="text-align: right;">
                        <div style="font-size: 1rem; font-weight: 600; color: #d97706;">
                          ${pattern.avgGlucoseChange > 0 ? '+' : ''}${pattern.avgGlucoseChange} mg/dL
                        </div>
                        <div style="font-size: 0.75rem; color: #6b7280;">í‰ê·  ë³€í™”</div>
                      </div>
                    </div>
                  </div>
                `).join('')
              }
            </div>
          </div>
        </div>
      `;
    }

    function renderCalculator(container, user) {
      container.innerHTML = `
        <div class="card full-width">
          <h2>ğŸ§® AI ê°œì¸í™” ì¸ìŠë¦° ê³„ì‚°ê¸°</h2>
          <p style="color: #6b7280; margin-bottom: 1.5rem;">
            ê°œì¸ ë°ì´í„°ë¥¼ í•™ìŠµí•˜ì—¬ ë§ì¶¤í˜• ì¸ìŠë¦° ìš©ëŸ‰ì„ ê³„ì‚°í•©ë‹ˆë‹¤. 
            <strong>ëª¨ë“  ê³„ì‚° ê²°ê³¼ëŠ” ì˜ë£Œì§„ê³¼ ìƒì˜ í›„ ì‚¬ìš©í•˜ì„¸ìš”.</strong>
          </p>
          
          <div class="form-grid">
            <div class="form-group">
              <label for="calcGlucose">í˜„ì¬ í˜ˆë‹¹ (mg/dL) *</label>
              <input type="number" id="calcGlucose" placeholder="í˜ˆë‹¹ì„ ì…ë ¥í•˜ì„¸ìš”" min="30" max="600">
            </div>
            
            <div class="form-group food-search">
              <label for="calcFood">ìŒì‹ ì´ë¦„ *</label>
              <input type="text" id="calcFood" placeholder="ìŒì‹ì„ ê²€ìƒ‰í•˜ì„¸ìš”" autocomplete="off">
              <div id="calcFoodSuggestions" class="food-suggestions"></div>
            </div>
            
            <div class="form-group">
              <label for="calcAmount">ì„­ì·¨ëŸ‰ (g) *</label>
              <input type="number" id="calcAmount" placeholder="ê·¸ë¨ ë‹¨ìœ„" min="0" step="0.1">
            </div>
            
            <div class="form-group">
              <label for="calcMealTiming">ì‹ì‚¬ ì‹œì </label>
              <select id="calcMealTiming">
                <option value="before">ì‹ì „</option>
                <option value="after">ì‹í›„</option>
              </select>
            </div>
          </div>
          
          <div id="calcPreview"></div>
          
          <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
            <button onclick="calculateInsulin()" class="btn btn-ai btn-full">
              ğŸ¤– AI ì¸ìŠë¦° ê³„ì‚°
            </button>
            <button onclick="saveCalculation()" class="btn btn-success">
              ğŸ’¾ ê¸°ë¡ìœ¼ë¡œ ì €ì¥
            </button>
          </div>
          
          <div id="calcResults"></div>
        </div>
      `;

      setupCalculatorListeners();
    }

    function setupCalculatorListeners() {
      const foodInput = document.getElementById('calcFood');
      const amountInput = document.getElementById('calcAmount');
      
      if (foodInput) {
        foodInput.addEventListener('input', (e) => {
          const query = e.target.value;
          showCalculatorFoodSuggestions(query);
          updateCalculatorPreview();
        });
        
        foodInput.addEventListener('blur', () => {
          setTimeout(() => hideCalculatorFoodSuggestions(), 200);
        });
      }
      
      if (amountInput) {
        amountInput.addEventListener('input', updateCalculatorPreview);
      }
    }

    function showCalculatorFoodSuggestions(query) {
      const suggestions = searchFood(query);
      const container = document.getElementById('calcFoodSuggestions');
      
      if (!container || suggestions.length === 0) {
        hideCalculatorFoodSuggestions();
        return;
      }
      
      container.innerHTML = suggestions.map(item => `
        <div class="food-suggestion" onclick="selectCalculatorFood('${item.name}')">
          <div>
            <strong>${item.name}</strong>
            <br>
            <small>${item.data.category} â€¢ íƒ„ìˆ˜í™”ë¬¼ ${item.data.carbs}g/100g â€¢ GI ${item.data.glycemicIndex}</small>
          </div>
          <div style="text-align: right; font-size: 0.875rem; color: #6b7280;">
            ${item.data.carbs}g
          </div>
        </div>
      `).join('');
      
      container.style.display = 'block';
    }

    function hideCalculatorFoodSuggestions() {
      const container = document.getElementById('calcFoodSuggestions');
      if (container) {
        container.style.display = 'none';
      }
    }

    function selectCalculatorFood(foodName) {
      document.getElementById('calcFood').value = foodName;
      hideCalculatorFoodSuggestions();
      updateCalculatorPreview();
    }

    function updateCalculatorPreview() {
      const food = document.getElementById('calcFood').value;
      const amount = document.getElementById('calcAmount').value;
      const preview = document.getElementById('calcPreview');
      const user = userManager.getCurrentUser();
      
      if (!food || !preview) return;
      
      let content = '';
      
      if (KOREAN_FOOD_DATABASE[food] && amount) {
        const foodData = KOREAN_FOOD_DATABASE[food];
        const carbs = Math.round(foodData.carbs * amount / 100);
        const protein = Math.round(foodData.protein * amount / 100);
        const fat = Math.round(foodData.fat * amount / 100);
        
        content += `
          <div class="preview-box">
            <h4 style="margin-bottom: 0.75rem; color: #1e40af;">ğŸ¥„ ì˜ì–‘ ì •ë³´ ë¶„ì„</h4>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 1rem; text-align: center;">
              <div><strong>${carbs}g</strong><br><small>íƒ„ìˆ˜í™”ë¬¼</small></div>
              <div><strong>${protein}g</strong><br><small>ë‹¨ë°±ì§ˆ</small></div>
              <div><strong>${fat}g</strong><br><small>ì§€ë°©</small></div>
              <div><strong>GI ${foodData.glycemicIndex}</strong><br><small>í˜ˆë‹¹ì§€ìˆ˜</small></div>
            </div>
            <div style="margin-top: 1rem; padding: 0.75rem; background: rgba(59, 130, 246, 0.1); border-radius: 0.5rem;">
              <p style="font-size: 0.875rem;"><strong>ë°ì´í„° ì¶œì²˜:</strong> ${foodData.source} ê³µì‹ ë°ì´í„°ë² ì´ìŠ¤</p>
            </div>
          </div>
        `;
      }
      
      // ê°œì¸ë³„ ìŒì‹ íˆìŠ¤í† ë¦¬
      if (user.personalizedData.foodReactions[food]) {
        const reaction = user.personalizedData.foodReactions[food];
        content += `
          <div class="personal-analysis">
            <h4 style="margin-bottom: 0.75rem; color: #0c4a6e;">ğŸ“Š ê°œì¸ ë°˜ì‘ ë¶„ì„</h4>
            <p style="margin-bottom: 0.5rem;">
              <strong>${food}</strong>ì„(ë¥¼) ${reaction.count}íšŒ ì„­ì·¨í•œ ê¸°ë¡ì´ ìˆìŠµë‹ˆë‹¤.
            </p>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem; text-align: center;">
              <div><strong>${reaction.avgGlucose}mg/dL</strong><br><small>í‰ê·  í˜ˆë‹¹</small></div>
              <div><strong>${reaction.avgCarbs}g</strong><br><small>í‰ê·  íƒ„ìˆ˜í™”ë¬¼</small></div>
              <div><strong>${reaction.avgInsulin}ë‹¨ìœ„</strong><br><small>í‰ê·  ì¸ìŠë¦°</small></div>
              <div><strong style="color: ${reaction.riskLevel === 'high' ? '#ef4444' : reaction.riskLevel === 'medium' ? '#f59e0b' : '#10b981'};">
                ${reaction.riskLevel === 'high' ? 'ì£¼ì˜' : reaction.riskLevel === 'medium' ? 'ë³´í†µ' : 'ì•ˆì „'}
              </strong><br><small>ìœ„í—˜ë„</small></div>
            </div>
          </div>
        `;
      }
      
      preview.innerHTML = content;
    }

    function calculateInsulin() {
      const glucose = parseFloat(document.getElementById('calcGlucose').value);
      const food = document.getElementById('calcFood').value;
      const amount = parseFloat(document.getElementById('calcAmount').value);
      const mealTiming = document.getElementById('calcMealTiming').value;
      
      if (!glucose || !food || !amount) {
        alert('ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•˜ì„¸ìš”.');
        return;
      }
      
      if (!KOREAN_FOOD_DATABASE[food]) {
        alert('ì„ íƒí•œ ìŒì‹ì´ ë°ì´í„°ë² ì´ìŠ¤ì— ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      const carbs = Math.round(KOREAN_FOOD_DATABASE[food].carbs * amount / 100);
      const user = userManager.getCurrentUser();
      
      // AI ì—”ì§„ì„ ì‚¬ìš©í•œ ê°œì¸í™” ê³„ì‚°
      const result = aiEngine.calculatePersonalizedInsulin(glucose, carbs, user.personalizedData);
      
      calculationResult = {
        glucose,
        food,
        amount,
        carbs,
        mealTiming,
        ...result,
        timestamp: new Date().toISOString()
      };
      
      // ê²°ê³¼ í‘œì‹œ
      const resultsContainer = document.getElementById('calcResults');
      resultsContainer.innerHTML = `
        <div class="ai-recommendations">
          <h3 style="margin-bottom: 1rem; color: #7c3aed;">ğŸ¤– AI ê°œì¸í™” ì¸ìŠë¦° ê³„ì‚° ê²°ê³¼</h3>
          
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
            <div style="text-align: center; padding: 1rem; background: rgba(255, 255, 255, 0.5); border-radius: 0.75rem;">
              <div style="font-size: 1.5rem; font-weight: bold; color: #7c3aed;">${result.carbInsulin}</div>
              <div style="font-size: 0.875rem; color: #6b7280;">íƒ„ìˆ˜í™”ë¬¼ ì¸ìŠë¦°</div>
            </div>
            
            <div style="text-align: center; padding: 1rem; background: rgba(255, 255, 255, 0.5); border-radius: 0.75rem;">
              <div style="font-size: 1.5rem; font-weight: bold; color: #7c3aed;">${result.correctionInsulin}</div>
              <div style="font-size: 0.875rem; color: #6b7280;">êµì • ì¸ìŠë¦°</div>
            </div>
            
            <div style="text-align: center; padding: 1rem; background: rgba(139, 92, 246, 0.2); border-radius: 0.75rem; border: 2px solid #8b5cf6;">
              <div style="font-size: 2rem; font-weight: bold; color: #7c3aed;">${result.total}</div>
              <div style="font-size: 1rem; font-weight: 600; color: #7c3aed;">ì´ ì¸ìŠë¦° ë‹¨ìœ„</div>
            </div>
            
            <div style="text-align: center; padding: 1rem; background: rgba(255, 255, 255, 0.5); border-radius: 0.75rem;">
              <div style="font-size: 1.5rem; font-weight: bold; color: #10b981;">${result.confidence}%</div>
              <div style="font-size: 0.875rem; color: #6b7280;">ì‹ ë¢°ë„</div>
            </div>
          </div>
          
          <div style="padding: 1rem; background: rgba(255, 255, 255, 0.7); border-radius: 0.75rem; margin-bottom: 1rem;">
            <h4 style="margin-bottom: 0.5rem; color: #1f2937;">ê°œì¸í™” ì •ë³´</h4>
            <p style="font-size: 0.875rem; color: #6b7280;">
              ê°œì¸ ICR: ${result.personalICR}g/ë‹¨ìœ„ â€¢ ê°œì¸ ISF: ${result.personalISF}mg/dL/ë‹¨ìœ„<br>
              íƒ„ìˆ˜í™”ë¬¼: ${carbs}g â€¢ í˜„ì¬ í˜ˆë‹¹: ${glucose}mg/dL
            </p>
          </div>
          
          <div style="padding: 1rem; background: rgba(239, 68, 68, 0.1); border: 1px solid #ef4444; border-radius: 0.75rem;">
            <p style="font-size: 0.875rem; color: #991b1b; font-weight: 500;">
              âš ï¸ ì£¼ì˜ì‚¬í•­: ì´ ê³„ì‚° ê²°ê³¼ëŠ” ì°¸ê³ ìš©ì´ë©°, ì‹¤ì œ ì¸ìŠë¦° íˆ¬ì—¬ ì „ ë°˜ë“œì‹œ ë‹´ë‹¹ ì˜ë£Œì§„ê³¼ ìƒë‹´í•˜ì„¸ìš”. 
              ê°œì¸ì˜ ìƒí™©ì— ë”°ë¼ ìš©ëŸ‰ ì¡°ì •ì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </p>
          </div>
        </div>
      `;
    }

    function saveCalculation() {
      if (!calculationResult) {
        alert('ë¨¼ì € ì¸ìŠë¦°ì„ ê³„ì‚°í•˜ì„¸ìš”.');
        return;
      }
      
      const record = {
        id: Date.now(),
        timestamp: calculationResult.timestamp,
        glucose: calculationResult.glucose,
        food: calculationResult.food,
        amount: calculationResult.amount,
        carbs: calculationResult.carbs,
        insulin: calculationResult.total,
        mealTiming: calculationResult.mealTiming,
        calculatedBy: 'AI',
        confidence: calculationResult.confidence
      };
      
      userManager.addRecord(record);
      alert('ê¸°ë¡ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
      
      // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
      document.getElementById('calcGlucose').value = '';
      document.getElementById('calcFood').value = '';
      document.getElementById('calcAmount').value = '';
      document.getElementById('calcPreview').innerHTML = '';
      document.getElementById('calcResults').innerHTML = '';
      calculationResult = null;
    }

    function renderRecordForm(container, user) {
      container.innerHTML = `
        <div class="card full-width">
          <h2>â• í˜ˆë‹¹ ê¸°ë¡ ì¶”ê°€</h2>
          <p style="color: #6b7280; margin-bottom: 1.5rem;">
            ì¼ìƒì˜ í˜ˆë‹¹ ë°ì´í„°ë¥¼ ê¸°ë¡í•˜ì—¬ ê°œì¸í™”ëœ ë¶„ì„ì„ ë°›ì•„ë³´ì„¸ìš”.
          </p>
          
          <div class="form-grid">
            <div class="form-group">
              <label for="recordGlucose">í˜ˆë‹¹ (mg/dL) *</label>
              <input type="number" id="recordGlucose" placeholder="í˜ˆë‹¹ì„ ì…ë ¥í•˜ì„¸ìš”" min="30" max="600" required>
            </div>
            
            <div class="form-group food-search">
              <label for="recordFood">ìŒì‹ ì´ë¦„</label>
              <input type="text" id="recordFood" placeholder="ìŒì‹ì„ ê²€ìƒ‰í•˜ì„¸ìš”" autocomplete="off">
              <div id="recordFoodSuggestions" class="food-suggestions"></div>
            </div>
            
            <div class="form-group">
              <label for="recordAmount">ì„­ì·¨ëŸ‰ (g)</label>
              <input type="number" id="recordAmount" placeholder="ê·¸ë¨ ë‹¨ìœ„" min="0" step="0.1">
            </div>
            
            <div class="form-group">
              <label for="recordCarbs">íƒ„ìˆ˜í™”ë¬¼ (g)</label>
              <input type="number" id="recordCarbs" placeholder="ì§ì ‘ ì…ë ¥ ë˜ëŠ” ìë™ ê³„ì‚°" min="0" step="0.1">
            </div>
            
            <div class="form-group">
              <label for="recordInsulin">ì¸ìŠë¦° (ë‹¨ìœ„)</label>
              <input type="number" id="recordInsulin" placeholder="íˆ¬ì—¬í•œ ì¸ìŠë¦° ë‹¨ìœ„" min="0" step="0.1">
            </div>
            
            <div class="form-group">
              <label for="recordTiming">ì¸¡ì • ì‹œì </label>
              <select id="recordTiming">
                <option value="fasting">ê³µë³µ</option>
                <option value="before_meal">ì‹ì „</option>
                <option value="after_meal_1h">ì‹í›„ 1ì‹œê°„</option>
                <option value="after_meal_2h">ì‹í›„ 2ì‹œê°„</option>
                <option value="before_sleep">ì·¨ì¹¨ì „</option>
                <option value="exercise">ìš´ë™ ì „í›„</option>
                <option value="other">ê¸°íƒ€</option>
              </select>
            </div>
          </div>
          
          <div class="form-group">
            <label for="recordMemo">ë©”ëª¨</label>
            <textarea id="recordMemo" placeholder="ì¶”ê°€ ë©”ëª¨ (ì„ íƒì‚¬í•­)" rows="3"></textarea>
          </div>
          
          <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
            <button onclick="saveRecord()" class="btn btn-success btn-full">
              ğŸ’¾ ê¸°ë¡ ì €ì¥
            </button>
            <button onclick="clearRecordForm()" class="btn btn-primary">
              ğŸ—‘ï¸ ì´ˆê¸°í™”
            </button>
          </div>
        </div>
      `;

      setupRecordListeners();
    }

    function setupRecordListeners() {
      const foodInput = document.getElementById('recordFood');
      const amountInput = document.getElementById('recordAmount');
      const carbsInput = document.getElementById('recordCarbs');
      
      if (foodInput) {
        foodInput.addEventListener('input', (e) => {
          const query = e.target.value;
          showRecordFoodSuggestions(query);
          updateRecordCarbs();
        });
        
        foodInput.addEventListener('blur', () => {
          setTimeout(() => hideRecordFoodSuggestions(), 200);
        });
      }
      
      if (amountInput) {
        amountInput.addEventListener('input', updateRecordCarbs);
      }
    }

    function showRecordFoodSuggestions(query) {
      const suggestions = searchFood(query);
      const container = document.getElementById('recordFoodSuggestions');
      
      if (!container || suggestions.length === 0) {
        hideRecordFoodSuggestions();
        return;
      }
      
      container.innerHTML = suggestions.map(item => `
        <div class="food-suggestion" onclick="selectRecordFood('${item.name}')">
          <div>
            <strong>${item.name}</strong>
            <br>
            <small>${item.data.category} â€¢ íƒ„ìˆ˜í™”ë¬¼ ${item.data.carbs}g/100g</small>
          </div>
          <div style="text-align: right; font-size: 0.875rem; color: #6b7280;">
            ${item.data.carbs}g
          </div>
        </div>
      `).join('');
      
      container.style.display = 'block';
    }

    function hideRecordFoodSuggestions() {
      const container = document.getElementById('recordFoodSuggestions');
      if (container) {
        container.style.display = 'none';
      }
    }

    function selectRecordFood(foodName) {
      document.getElementById('recordFood').value = foodName;
      hideRecordFoodSuggestions();
      updateRecordCarbs();
    }

    function updateRecordCarbs() {
      const food = document.getElementById('recordFood').value;
      const amount = document.getElementById('recordAmount').value;
      const carbsInput = document.getElementById('recordCarbs');
      
      if (food && amount && KOREAN_FOOD_DATABASE[food] && carbsInput) {
        const carbs = calculateCarbs(food, amount);
        if (carbs > 0) {
          carbsInput.value = carbs;
        }
      }
    }

    function saveRecord() {
      const glucose = document.getElementById('recordGlucose').value;
      const food = document.getElementById('recordFood').value;
      const amount = document.getElementById('recordAmount').value;
      const carbs = document.getElementById('recordCarbs').value;
      const insulin = document.getElementById('recordInsulin').value;
      const timing = document.getElementById('recordTiming').value;
      const memo = document.getElementById('recordMemo').value;
      
      if (!glucose) {
        alert('í˜ˆë‹¹ì€ í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.');
        return;
      }
      
      const record = {
        id: Date.now(),
        timestamp: new Date().toISOString(),
        glucose: parseFloat(glucose),
        food: food || null,
        amount: amount ? parseFloat(amount) : null,
        carbs: carbs ? parseFloat(carbs) : null,
        insulin: insulin ? parseFloat(insulin) : null,
        timing: timing,
        memo: memo || null
      };
      
      userManager.addRecord(record);
      alert('ê¸°ë¡ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
      clearRecordForm();
    }

    function clearRecordForm() {
      document.getElementById('recordGlucose').value = '';
      document.getElementById('recordFood').value = '';
      document.getElementById('recordAmount').value = '';
      document.getElementById('recordCarbs').value = '';
      document.getElementById('recordInsulin').value = '';
      document.getElementById('recordTiming').value = 'fasting';
      document.getElementById('recordMemo').value = '';
    }

    function renderExercise(container, user) {
      container.innerHTML = `
        <div class="main-grid">
          <div class="card">
            <h2>ğŸƒâ€â™‚ï¸ ìš´ë™ ê¸°ë¡</h2>
            
            <div class="form-group">
              <label for="exerciseType">ìš´ë™ ì¢…ëª©</label>
              <input type="text" id="exerciseType" placeholder="ìš´ë™ì„ ê²€ìƒ‰í•˜ì„¸ìš”" autocomplete="off">
              <div id="exerciseSuggestions" class="food-suggestions"></div>
            </div>
            
            <div class="form-grid">
              <div class="form-group">
                <label for="preExerciseGlucose">ìš´ë™ ì „ í˜ˆë‹¹ (mg/dL)</label>
                <input type="number" id="preExerciseGlucose" placeholder="ìš´ë™ ì „ í˜ˆë‹¹" min="30" max="600">
              </div>
              
              <div class="form-group">
                <label for="postExerciseGlucose">ìš´ë™ í›„ í˜ˆë‹¹ (mg/dL)</label>
                <input type="number" id="postExerciseGlucose" placeholder="ìš´ë™ í›„ í˜ˆë‹¹" min="30" max="600">
              </div>
            </div>
            
            <div class="form-grid">
              <div class="form-group">
                <label for="exerciseDuration">ìš´ë™ ì‹œê°„ (ë¶„)</label>
                <input type="number" id="exerciseDuration" placeholder="ë¶„ ë‹¨ìœ„" min="1" max="480">
              </div>
              
              <div class="form-group">
                <label for="exerciseIntensity">ìš´ë™ ê°•ë„</label>
                <select id="exerciseIntensity">
                  <option value="low">ë‚®ìŒ</option>
                  <option value="medium">ë³´í†µ</option>
                  <option value="high">ë†’ìŒ</option>
                </select>
              </div>
            </div>
            
            <div class="timer-controls">
              <button onclick="startExerciseTimer()" class="btn btn-exercise">
                â±ï¸ íƒ€ì´ë¨¸ ì‹œì‘
              </button>
              <button onclick="stopExerciseTimer()" class="btn btn-danger">
                â¹ï¸ íƒ€ì´ë¨¸ ì¢…ë£Œ
              </button>
            </div>
            
            <div id="timerDisplay" class="timer-display">0ë¶„</div>
            
            <button onclick="saveExerciseRecord()" class="btn btn-success btn-full">
              ğŸ’¾ ìš´ë™ ê¸°ë¡ ì €ì¥
            </button>
          </div>
          
          <div class="card">
            <h2>ğŸ“Š ìš´ë™ íš¨ê³¼ ì˜ˆì¸¡</h2>
            <div id="exercisePreview">
              <p style="color: #6b7280; text-align: center; padding: 2rem;">
                ìš´ë™ ì¢…ëª©ì„ ì„ íƒí•˜ë©´ ì˜ˆìƒ íš¨ê³¼ë¥¼ ë³´ì—¬ë“œë¦½ë‹ˆë‹¤.
              </p>
            </div>
          </div>
        </div>
        
        <div class="card full-width">
          <h2>ğŸ† ìš´ë™ë³„ ê°œì¸ ë¶„ì„</h2>
          <div id="exerciseAnalysis">
            ${Object.keys(user.personalizedData.exerciseReactions || {}).length === 0 ? 
              '<p style="color: #6b7280; text-align: center; padding: 2rem;">ì¶©ë¶„í•œ ìš´ë™ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë” ë§ì€ ìš´ë™ì„ ê¸°ë¡í•´ë³´ì„¸ìš”!</p>' :
              Object.entries(user.personalizedData.exerciseReactions).map(([exercise, data]) => `
                <div class="exercise-item">
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                    <div>
                      <strong>${exercise}</strong>
                      <div style="font-size: 0.875rem; color: #6b7280;">
                        ${data.count}íšŒ ê¸°ë¡ â€¢ í‰ê·  ${data.avgDuration}ë¶„
                      </div>
                    </div>
                    <div style="text-align: right;">
                      <div style="font-size: 1.25rem; font-weight: 600; color: ${data.avgGlucoseChange < 0 ? '#10b981' : '#f59e0b'};">
                        ${data.avgGlucoseChange > 0 ? '+' : ''}${data.avgGlucoseChange} mg/dL
                      </div>
                      <div style="font-size: 0.75rem; color: #6b7280;">í‰ê·  í˜ˆë‹¹ ë³€í™”</div>
                    </div>
                  </div>
                  <div style="display: flex; justify-content: space-between; align-items: center; font-size: 0.875rem; color: #6b7280;">
                    <span>ì•ˆì „ë„: <strong style="color: ${data.safetyLevel === 'safe' ? '#10b981' : data.safetyLevel === 'moderate' ? '#f59e0b' : '#ef4444'};">
                      ${data.safetyLevel === 'safe' ? 'ì•ˆì „' : data.safetyLevel === 'moderate' ? 'ë³´í†µ' : 'ì£¼ì˜'}
                    </strong></span>
                    <span>í‰ê·  ì¹¼ë¡œë¦¬: ${data.avgCaloriesBurned || 0}kcal</span>
                  </div>
                </div>
              `).join('')
            }
          </div>
        </div>
      `;

      setupExerciseListeners();
    }

    function setupExerciseListeners() {
      const exerciseInput = document.getElementById('exerciseType');
      
      if (exerciseInput) {
        exerciseInput.addEventListener('input', (e) => {
          const query = e.target.value;
          showExerciseSuggestions(query);
          updateExercisePreview();
        });
        
        exerciseInput.addEventListener('blur', () => {
          setTimeout(() => hideExerciseSuggestions(), 200);
        });
      }
    }

    function showExerciseSuggestions(query) {
      const suggestions = searchExercise(query);
      const container = document.getElementById('exerciseSuggestions');
      
      if (!container || suggestions.length === 0) {
        hideExerciseSuggestions();
        return;
      }
      
      container.innerHTML = suggestions.map(item => `
        <div class="food-suggestion" onclick="selectExercise('${item.name}')">
          <div>
            <strong>${item.name}</strong>
            <br>
            <small>${item.data.category} â€¢ ${item.data.intensity} ê°•ë„</small>
          </div>
          <div style="text-align: right; font-size: 0.875rem; color: #6b7280;">
            ${item.data.caloriesPerMinute}kcal/ë¶„
          </div>
        </div>
      `).join('');
      
      container.style.display = 'block';
    }

    function hideExerciseSuggestions() {
      const container = document.getElementById('exerciseSuggestions');
      if (container) {
        container.style.display = 'none';
      }
    }

    function selectExercise(exerciseName) {
      document.getElementById('exerciseType').value = exerciseName;
      hideExerciseSuggestions();
      updateExercisePreview();
    }

    function updateExercisePreview() {
      const exerciseType = document.getElementById('exerciseType').value;
      const preGlucose = document.getElementById('preExerciseGlucose').value;
      const duration = document.getElementById('exerciseDuration').value;
      const preview = document.getElementById('exercisePreview');
      
      if (!exerciseType || !EXERCISE_DATABASE[exerciseType]) {
        preview.innerHTML = '<p style="color: #6b7280; text-align: center; padding: 2rem;">ìš´ë™ ì¢…ëª©ì„ ì„ íƒí•˜ë©´ ì˜ˆìƒ íš¨ê³¼ë¥¼ ë³´ì—¬ë“œë¦½ë‹ˆë‹¤.</p>';
        return;
      }
      
      const exerciseData = EXERCISE_DATABASE[exerciseType];
      const estimatedCalories = duration ? Math.round(exerciseData.caloriesPerMinute * duration) : 0;
      const estimatedGlucoseChange = duration ? Math.round(exerciseData.glucoseEffect * duration / 30) : exerciseData.glucoseEffect;
      
      let content = `
        <div class="exercise-preview">
          <h4 style="margin-bottom: 0.75rem; color: #d97706;">ğŸ¯ ${exerciseType} ì˜ˆìƒ íš¨ê³¼</h4>
          
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem; text-align: center; margin-bottom: 1rem;">
            <div><strong>${exerciseData.intensity}</strong><br><small>ê°•ë„</small></div>
            <div><strong>${exerciseData.caloriesPerMinute}kcal/ë¶„</strong><br><small>ì¹¼ë¡œë¦¬ ì†Œëª¨</small></div>
            ${duration ? `<div><strong>${estimatedCalories}kcal</strong><br><small>ì´ ì˜ˆìƒ ì¹¼ë¡œë¦¬</small></div>` : ''}
            <div><strong>${estimatedGlucoseChange}mg/dL</strong><br><small>ì˜ˆìƒ í˜ˆë‹¹ ë³€í™”</small></div>
          </div>
        </div>
      `;
      
      // ìš´ë™ ì „ í˜ˆë‹¹ì´ ì…ë ¥ëœ ê²½ìš° ì•ˆì „ì„± ì²´í¬
      if (preGlucose) {
        const glucose = parseFloat(preGlucose);
        const recommendations = aiEngine.getExerciseRecommendation(glucose, exerciseType, 'fasting');
        
        if (recommendations && recommendations.length > 0) {
          content += `
            <div class="exercise-safety">
              <h4 style="margin-bottom: 0.75rem; color: #dc2626;">âš•ï¸ ìš´ë™ ì•ˆì „ì„± ê¶Œê³ </h4>
              ${recommendations.map(rec => `
                <div style="margin-bottom: 0.5rem; padding: 0.5rem; background: rgba(255, 255, 255, 0.5); border-radius: 0.5rem;">
                  <div style="font-weight: 500; color: ${rec.type === 'danger' ? '#dc2626' : rec.type === 'warning' ? '#d97706' : '#059669'};">
                    ${rec.type === 'danger' ? 'ğŸš¨' : rec.type === 'warning' ? 'âš ï¸' : 'ğŸ’¡'} ${rec.priority}
                  </div>
                  <div style="font-size: 0.875rem; margin-top: 0.25rem;">${rec.message}</div>
                </div>
              `).join('')}
            </div>
          `;
        }
      }
      
      preview.innerHTML = content;
    }

    function startExerciseTimer() {
      exerciseTimer.start();
      alert('ìš´ë™ íƒ€ì´ë¨¸ê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤!');
    }

    function stopExerciseTimer() {
      exerciseTimer.stop();
      const duration = exerciseTimer.getDuration();
      document.getElementById('exerciseDuration').value = duration;
      alert(`ìš´ë™ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ì´ ${duration}ë¶„ ìš´ë™í•˜ì…¨ìŠµë‹ˆë‹¤.`);
      updateExercisePreview();
    }

    function saveExerciseRecord() {
      const exerciseType = document.getElementById('exerciseType').value;
      const preGlucose = document.getElementById('preExerciseGlucose').value;
      const postGlucose = document.getElementById('postExerciseGlucose').value;
      const duration = document.getElementById('exerciseDuration').value;
      const intensity = document.getElementById('exerciseIntensity').value;
      
      if (!exerciseType || !duration) {
        alert('ìš´ë™ ì¢…ëª©ê³¼ ì‹œê°„ì€ í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.');
        return;
      }
      
      const exerciseData = EXERCISE_DATABASE[exerciseType];
      const caloriesBurned = exerciseData ? Math.round(exerciseData.caloriesPerMinute * duration) : 0;
      
      const record = {
        id: Date.now(),
        timestamp: new Date().toISOString(),
        exerciseType: exerciseType,
        preExerciseGlucose: preGlucose ? parseFloat(preGlucose) : null,
        postExerciseGlucose: postGlucose ? parseFloat(postGlucose) : null,
        duration: parseFloat(duration),
        intensity: intensity,
        caloriesBurned: caloriesBurned,
        startTime: exerciseTimer.startTime ? exerciseTimer.startTime.toISOString() : null
      };
      
      userManager.addExerciseRecord(record);
      alert('ìš´ë™ ê¸°ë¡ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
      
      // í¼ ì´ˆê¸°í™”
      document.getElementById('exerciseType').value = '';
      document.getElementById('preExerciseGlucose').value = '';
      document.getElementById('postExerciseGlucose').value = '';
      document.getElementById('exerciseDuration').value = '';
      document.getElementById('exerciseIntensity').value = 'medium';
      document.getElementById('exercisePreview').innerHTML = '<p style="color: #6b7280; text-align: center; padding: 2rem;">ìš´ë™ ì¢…ëª©ì„ ì„ íƒí•˜ë©´ ì˜ˆìƒ íš¨ê³¼ë¥¼ ë³´ì—¬ë“œë¦½ë‹ˆë‹¤.</p>';
      
      // íƒ€ì´ë¨¸ ë¦¬ì…‹
      exerciseTimer = new ExerciseTimer();
      document.getElementById('timerDisplay').textContent = '0ë¶„';
      
      renderMainApp(); // ì—…ë°ì´íŠ¸ëœ ë°ì´í„° ë°˜ì˜
    }

    function renderAnalysis(container, user) {
      const data = user.personalizedData;
      
      container.innerHTML = `
        <div class="card full-width">
          <h2>ğŸ“ˆ ê°œì¸í™” í˜ˆë‹¹ ë¶„ì„</h2>
          
          <div class="stats-dashboard">
            <div class="stat-card">
              <div class="stat-value">${data.avgGlucose || 0}</div>
              <div class="stat-label">ì „ì²´ í‰ê·  í˜ˆë‹¹</div>
            </div>
            <div class="stat-card">
              <div class="stat-value">${data.timeInRange || 0}%</div>
              <div class="stat-label">ëª©í‘œ ë²”ìœ„ ì‹œê°„ (TIR)</div>
            </div>
            <div class="stat-card">
              <div class="stat-value">${data.personalICR || 15}</div>
              <div class="stat-label">ê°œì¸ ICR</div>
            </div>
            <div class="stat-card">
              <div class="stat-value">${data.personalISF || 50}</div>
              <div class="stat-label">ê°œì¸ ISF</div>
            </div>
          </div>
        </div>
        
        <div class="main-grid">
          <div class="card">
            <h2>ğŸ½ï¸ ìŒì‹ë³„ í˜ˆë‹¹ ë°˜ì‘</h2>
            ${Object.keys(data.foodReactions).length === 0 ? 
              '<p style="color: #6b7280; text-align: center; padding: 2rem;">ì¶©ë¶„í•œ ìŒì‹ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>' :
              Object.entries(data.foodReactions).slice(0, 10).map(([food, reaction]) => `
                <div class="pattern-item">
                  <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                      <strong>${food}</strong>
                      <div style="font-size: 0.875rem; color: #6b7280;">${reaction.count}íšŒ ì„­ì·¨</div>
                    </div>
                    <div style="text-align: right;">
                      <div style="font-size: 1.25rem; font-weight: 600; color: ${getGlucoseColor(reaction.avgGlucose)};">
                        ${reaction.avgGlucose} mg/dL
                      </div>
                      <div style="font-size: 0.75rem; color: #6b7280;">í‰ê·  í˜ˆë‹¹</div>
                    </div>
                  </div>
                </div>
              `).join('')
            }
          </div>
          
          <div class="card">
            <h2>ğŸƒâ€â™‚ï¸ ìš´ë™ë³„ í˜ˆë‹¹ íš¨ê³¼</h2>
            ${Object.keys(data.exerciseReactions || {}).length === 0 ? 
              '<p style="color: #6b7280; text-align: center; padding: 2rem;">ì¶©ë¶„í•œ ìš´ë™ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>' :
              Object.entries(data.exerciseReactions).slice(0, 10).map(([exercise, reaction]) => `
                <div class="exercise-item">
                  <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                      <strong>${exercise}</strong>
                      <div style="font-size: 0.875rem; color: #6b7280;">${reaction.count}íšŒ â€¢ ${reaction.avgDuration}ë¶„</div>
                    </div>
                    <div style="text-align: right;">
                      <div style="font-size: 1.25rem; font-weight: 600; color: ${reaction.avgGlucoseChange < 0 ? '#10b981' : '#f59e0b'};">
                        ${reaction.avgGlucoseChange > 0 ? '+' : ''}${reaction.avgGlucoseChange} mg/dL
                      </div>
                      <div style="font-size: 0.75rem; color: #6b7280;">í‰ê·  ë³€í™”</div>
                    </div>
                  </div>
                </div>
              `).join('')
            }
          </div>
        </div>
      `;
    }

    function renderFoodPatterns(container, user) {
      const foodReactions = user.personalizedData.foodReactions;
      
      container.innerHTML = `
        <div class="card full-width">
          <h2>ğŸ½ï¸ ê°œì¸ë³„ ìŒì‹ ë°˜ì‘ íŒ¨í„´</h2>
          <p style="color: #6b7280; margin-bottom: 1.5rem;">
            ì„­ì·¨í•œ ìŒì‹ë³„ í˜ˆë‹¹ ë°˜ì‘ì„ ë¶„ì„í•˜ì—¬ ê°œì¸ ë§ì¶¤ ì‹ë‹¨ ê´€ë¦¬ë¥¼ ë„ì™€ë“œë¦½ë‹ˆë‹¤.
          </p>
          
          ${Object.keys(foodReactions).length === 0 ? 
            '<div style="text-align: center; padding: 3rem; color: #6b7280;"><h3>ì•„ì§ ì¶©ë¶„í•œ ìŒì‹ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</h3><p>ë” ë§ì€ ìŒì‹ ê¸°ë¡ì„ ì¶”ê°€í•˜ì—¬ ê°œì¸í™”ëœ ë¶„ì„ì„ ë°›ì•„ë³´ì„¸ìš”!</p></div>' :
            `
            <div class="main-grid">
              <div class="card">
                <h3>ğŸŸ¢ ì•ˆì „í•œ ìŒì‹ (ê¶Œì¥)</h3>
                ${Object.entries(foodReactions)
                  .filter(([food, data]) => data.riskLevel === 'low')
                  .slice(0, 10)
                  .map(([food, data]) => `
                    <div class="pattern-item">
                      <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                          <strong>${food}</strong>
                          <div style="font-size: 0.875rem; color: #6b7280;">
                            ${data.count}íšŒ ì„­ì·¨ â€¢ í‰ê·  ${data.avgCarbs}g íƒ„ìˆ˜í™”ë¬¼
                          </div>
                        </div>
                        <div style="text-align: right;">
                          <div style="font-size: 1.1rem; font-weight: 600; color: #10b981;">
                            ${data.avgGlucose} mg/dL
                          </div>
                          <div style="font-size: 0.75rem; color: #10b981;">ì•ˆì „</div>
                        </div>
                      </div>
                    </div>
                  `).join('') || '<p style="color: #6b7280; text-align: center; padding: 1rem;">ë°ì´í„° ì—†ìŒ</p>'}
              </div>
              
              <div class="card">
                <h3>ğŸŸ¡ ì£¼ì˜ ìŒì‹ (ì ë‹¹íˆ)</h3>
                ${Object.entries(foodReactions)
                  .filter(([food, data]) => data.riskLevel === 'medium')
                  .slice(0, 10)
                  .map(([food, data]) => `
                    <div class="pattern-item" style="border-left: 4px solid #f59e0b;">
                      <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                          <strong>${food}</strong>
                          <div style="font-size: 0.875rem; color: #6b7280;">
                            ${data.count}íšŒ ì„­ì·¨ â€¢ í‰ê·  ${data.avgCarbs}g íƒ„ìˆ˜í™”ë¬¼
                          </div>
                        </div>
                        <div style="text-align: right;">
                          <div style="font-size: 1.1rem; font-weight: 600; color: #f59e0b;">
                            ${data.avgGlucose} mg/dL
                          </div>
                          <div style="font-size: 0.75rem; color: #f59e0b;">ì£¼ì˜</div>
                        </div>
                      </div>
                    </div>
                  `).join('') || '<p style="color: #6b7280; text-align: center; padding: 1rem;">ë°ì´í„° ì—†ìŒ</p>'}
              </div>
            </div>
            
            <div class="card">
              <h3>ğŸ”´ ìœ„í—˜ ìŒì‹ (ì œí•œ ê¶Œì¥)</h3>
              ${Object.entries(foodReactions)
                .filter(([food, data]) => data.riskLevel === 'high')
                .slice(0, 10)
                .map(([food, data]) => `
                  <div class="pattern-item" style="border-left: 4px solid #ef4444; background: rgba(239, 68, 68, 0.05);">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                      <div>
                        <strong>${food}</strong>
                        <div style="font-size: 0.875rem; color: #6b7280;">
                          ${data.count}íšŒ ì„­ì·¨ â€¢ í‰ê·  ${data.avgCarbs}g íƒ„ìˆ˜í™”ë¬¼ â€¢ í‰ê·  ${data.avgInsulin}ë‹¨ìœ„ ì¸ìŠë¦°
                        </div>
                      </div>
                      <div style="text-align: right;">
                        <div style="font-size: 1.1rem; font-weight: 600; color: #ef4444;">
                          ${data.avgGlucose} mg/dL
                        </div>
                        <div style="font-size: 0.75rem; color: #ef4444;">ìœ„í—˜</div>
                      </div>
                    </div>
                    <div style="margin-top: 0.5rem; font-size: 0.8rem; color: #dc2626; font-weight: 500;">
                      âš ï¸ ì´ ìŒì‹ì€ í˜ˆë‹¹ì„ í¬ê²Œ ìƒìŠ¹ì‹œí‚µë‹ˆë‹¤. ì„­ì·¨ ì‹œ ì¸ìŠë¦° ìš©ëŸ‰ ì¡°ì •ì´ë‚˜ ì˜ë£Œì§„ ìƒë‹´ì„ ê¶Œì¥í•©ë‹ˆë‹¤.
                    </div>
                  </div>
                `).join('') || '<p style="color: #6b7280; text-align: center; padding: 1rem;">ë‹¤í–‰íˆ ìœ„í—˜í•œ ìŒì‹ì´ ì—†ìŠµë‹ˆë‹¤!</p>'}
            </div>
            `
          }
        </div>
      `;
    }

    function renderEmergency(container, user) {
      container.innerHTML = `
        <div class="card full-width">
          <h2>ğŸš¨ ì‘ê¸‰ìƒí™© ê°€ì´ë“œ</h2>
          
          <div style="background: rgba(239, 68, 68, 0.1); border: 2px solid #ef4444; border-radius: 1rem; padding: 1.5rem; margin-bottom: 2rem;">
            <h3 style="color: #dc2626; margin-bottom: 1rem;">âš ï¸ ì¦‰ì‹œ 119ì— ì—°ë½í•´ì•¼ í•˜ëŠ” ìƒí™©</h3>
            <ul style="color: #991b1b; line-height: 1.8;">
              <li>ì˜ì‹ì„ ìƒì—ˆê±°ë‚˜ ë°˜ì‘ì´ ì—†ëŠ” ê²½ìš°</li>
              <li>ì‹¬í•œ ì €í˜ˆë‹¹ìœ¼ë¡œ ê²½ë ¨ì´ë‚˜ ë°œì‘ì´ ìˆëŠ” ê²½ìš°</li>
              <li>ì§€ì†ì ì¸ êµ¬í† ë¡œ ìˆ˜ë¶„ ì„­ì·¨ê°€ ë¶ˆê°€ëŠ¥í•œ ê²½ìš°</li>
              <li>ì¼€í†¤ì‚°ì¦ ì˜ì‹¬ ì¦ìƒ (êµ¬í† , ë³µí†µ, ê³¼ë„í•œ ê°ˆì¦)</li>
              <li>í˜ˆë‹¹ì´ 500mg/dL ì´ìƒì¸ ê²½ìš°</li>
            </ul>
          </div>
          
          <div class="main-grid">
            <div class="card">
              <h3 style="color: #ef4444;">ğŸ©¸ ì €í˜ˆë‹¹ ì‘ê¸‰ì²˜ì¹˜</h3>
              <div style="background: rgba(239, 68, 68, 0.05); padding: 1rem; border-radius: 0.75rem; margin-bottom: 1rem;">
                <h4 style="margin-bottom: 0.5rem;">í˜ˆë‹¹ 70mg/dL ë¯¸ë§Œ ì‹œ</h4>
                <ol style="line-height: 1.6;">
                  <li><strong>ì¦‰ì‹œ 15g ì†íš¨ì„± íƒ„ìˆ˜í™”ë¬¼ ì„­ì·¨</strong>
                    <ul style="margin-top: 0.5rem; color: #6b7280;">
                      <li>í¬ë„ë‹¹ ì •ì œ 3-4ì •</li>
                      <li>ì„¤íƒ• 1í°ìˆ  (15g)</li>
                      <li>ê¿€ 1í°ìˆ </li>
                      <li>ì˜¤ë Œì§€ ì£¼ìŠ¤ 120ml</li>
                    </ul>
                  </li>
                  <li><strong>15ë¶„ í›„ í˜ˆë‹¹ ì¬ì¸¡ì •</strong></li>
                  <li><strong>ì—¬ì „íˆ 70mg/dL ë¯¸ë§Œì´ë©´ ë°˜ë³µ</strong></li>
                  <li><strong>ì •ìƒí™”ë˜ë©´ ë³µí•©íƒ„ìˆ˜í™”ë¬¼ ì„­ì·¨</strong></li>
                </ol>
              </div>
              
              <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid #f59e0b; padding: 1rem; border-radius: 0.75rem;">
                <p style="font-size: 0.875rem; color: #92400e;">
                  <strong>ì˜ì‹ì´ ì—†ëŠ” ê²½ìš°:</strong> ì ˆëŒ€ ìŒì‹ì„ ì…ì— ë„£ì§€ ë§ˆì„¸ìš”. ì¦‰ì‹œ 119ì— ì—°ë½í•˜ê³  ê¸€ë£¨ì¹´ê³¤ ì£¼ì‚¬ë¥¼ íˆ¬ì—¬í•˜ì„¸ìš”.
                </p>
              </div>
            </div>
            
            <div class="card">
              <h3 style="color: #f59e0b;">ğŸ“ˆ ê³ í˜ˆë‹¹ ì‘ê¸‰ì²˜ì¹˜</h3>
              <div style="background: rgba(245, 158, 11, 0.05); padding: 1rem; border-radius: 0.75rem; margin-bottom: 1rem;">
                <h4 style="margin-bottom: 0.5rem;">í˜ˆë‹¹ 250mg/dL ì´ìƒ ì‹œ</h4>
                <ol style="line-height: 1.6;">
                  <li><strong>ì¼€í†¤ ê²€ì‚¬ ì‹¤ì‹œ</strong></li>
                  <li><strong>ì¶©ë¶„í•œ ìˆ˜ë¶„ ì„­ì·¨</strong> (ë¬¼, ë¬´ì„¤íƒ• ìŒë£Œ)</li>
                  <li><strong>ì˜ë£Œì§„ì—ê²Œ ì—°ë½</strong></li>
                  <li><strong>ì¸ìŠë¦° íˆ¬ì—¬ ê³ ë ¤</strong> (ì˜ë£Œì§„ ì§€ì‹œí•˜ì—)</li>
                  <li><strong>ìš´ë™ ê¸ˆì§€</strong> (ì¼€í†¤ì´ ìˆëŠ” ê²½ìš°)</li>
                </ol>
              </div>
              
              <div style="background: rgba(239, 68, 68, 0.1); border: 1px solid #ef4444; padding: 1rem; border-radius: 0.75rem;">
                <h4 style="color: #dc2626; margin-bottom: 0.5rem;">ì¼€í†¤ì‚°ì¦ ì¦ìƒ</h4>
                <ul style="color: #991b1b; font-size: 0.875rem;">
                  <li>ê³¼ë„í•œ ê°ˆì¦ê³¼ ì¦ì€ ì†Œë³€</li>
                  <li>êµ¬í† , ë³µí†µ</li>
                  <li>í˜¸í¡ê³¤ë€, ê³¼ì¼ ëƒ„ìƒˆ í˜¸í¡</li>
                  <li>ì˜ì‹ ì €í•˜</li>
                </ul>
              </div>
            </div>
          </div>
          
          <div class="card full-width">
            <h3>ğŸ“ ì‘ê¸‰ ì—°ë½ì²˜</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem;">
              <div style="background: rgba(239, 68, 68, 0.1); padding: 1rem; border-radius: 0.75rem; text-align: center;">
                <div style="font-size: 2rem; font-weight: bold; color: #dc2626;">119</div>
                <div style="color: #991b1b;">ì‘ê¸‰ì‹¤</div>
              </div>
              
              <div style="background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: 0.75rem; text-align: center;">
                <div style="font-size: 1.5rem; font-weight: bold; color: #1d4ed8;">ë‹´ë‹¹ ë³‘ì›</div>
                <div style="color: #1e40af; font-size: 0.875rem;">í‰ì†Œ ë‹¤ë‹ˆëŠ” ë³‘ì›</div>
              </div>
              
              ${user.emergencyContact ? `
                <div style="background: rgba(16, 185, 129, 0.1); padding: 1rem; border-radius: 0.75rem; text-align: center;">
                  <div style="font-size: 1.25rem; font-weight: bold; color: #059669;">${user.emergencyContact}</div>
                  <div style="color: #047857; font-size: 0.875rem;">ë“±ë¡ëœ ì‘ê¸‰ ì—°ë½ì²˜</div>
                </div>
              ` : `
                <div style="background: rgba(156, 163, 175, 0.1); padding: 1rem; border-radius: 0.75rem; text-align: center;">
                  <div style="color: #6b7280;">ì‘ê¸‰ ì—°ë½ì²˜ ë¯¸ë“±ë¡</div>
                  <button onclick="switchTab('profile')" class="btn btn-primary btn-small" style="margin-top: 0.5rem;">
                    ì„¤ì •ì—ì„œ ë“±ë¡
                  </button>
                </div>
              `}
            </div>
          </div>
          
          <div style="background: rgba(59, 130, 246, 0.1); border: 2px solid #3b82f6; border-radius: 1rem; padding: 1.5rem; margin-top: 2rem;">
            <h3 style="color: #1e40af; margin-bottom: 1rem;">ğŸ’¡ ì‘ê¸‰ìƒí™© ì˜ˆë°© íŒ</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
              <div>
                <h4 style="color: #1d4ed8;">ì €í˜ˆë‹¹ ì˜ˆë°©</h4>
                <ul style="font-size: 0.875rem; color: #1e40af; line-height: 1.6;">
                  <li>ê·œì¹™ì ì¸ ì‹ì‚¬ì™€ ê°„ì‹</li>
                  <li>ìš´ë™ ì „í›„ í˜ˆë‹¹ ì²´í¬</li>
                  <li>í•­ìƒ ì‘ê¸‰ ê°„ì‹ íœ´ëŒ€</li>
                  <li>ì•Œì½”ì˜¬ ì„­ì·¨ ì‹œ ì£¼ì˜</li>
                </ul>
              </div>
              
              <div>
                <h4 style="color: #1d4ed8;">ê³ í˜ˆë‹¹ ì˜ˆë°©</h4>
                <ul style="font-size: 0.875rem; color: #1e40af; line-height: 1.6;">
                  <li>ì •í™•í•œ ì¸ìŠë¦° íˆ¬ì—¬</li>
                  <li>íƒ„ìˆ˜í™”ë¬¼ ê³„ì‚° ì •í™•íˆ</li>
                  <li>ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬</li>
                  <li>ì •ê¸°ì ì¸ í˜ˆë‹¹ ëª¨ë‹ˆí„°ë§</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function renderProfile(container, user) {
      container.innerHTML = `
        <div class="card full-width">
          <h2>âš™ï¸ ì‚¬ìš©ì ì„¤ì •</h2>
          
          <div class="main-grid">
            <div class="card">
              <h3>ğŸ‘¤ ê¸°ë³¸ ì •ë³´</h3>
              <div class="form-grid">
                <div class="form-group">
                  <label for="profileName">ì´ë¦„</label>
                  <input type="text" id="profileName" value="${user.name || ''}" placeholder="ì´ë¦„">
                </div>
                
                <div class="form-group">
                  <label for="profileAge">ë‚˜ì´</label>
                  <input type="number" id="profileAge" value="${user.age || ''}" placeholder="ë‚˜ì´" min="1" max="120">
                </div>
                
                <div class="form-group">
                  <label for="profileWeight">ì²´ì¤‘ (kg)</label>
                  <input type="number" id="profileWeight" value="${user.weight || ''}" placeholder="ì²´ì¤‘" step="0.1">
                </div>
                
                <div class="form-group">
                  <label for="profileHeight">ì‹ ì¥ (cm)</label>
                  <input type="number" id="profileHeight" value="${user.height || ''}" placeholder="ì‹ ì¥">
                </div>
              </div>
              
              <div class="form-group">
                <label for="profileEmergency">ì‘ê¸‰ ì—°ë½ì²˜</label>
                <input type="tel" id="profileEmergency" value="${user.emergencyContact || ''}" placeholder="010-0000-0000">
              </div>
              
              <button onclick="updateProfile()" class="btn btn-success btn-full">
                ğŸ’¾ ê¸°ë³¸ ì •ë³´ ì €ì¥
              </button>
            </div>
            
            <div class="card">
              <h3>ğŸ¯ ëª©í‘œ ì„¤ì •</h3>
              <div class="form-grid">
                <div class="form-group">
                  <label for="targetMinGlucose">ëª©í‘œ í˜ˆë‹¹ ìµœì†Œê°’ (mg/dL)</label>
                  <input type="number" id="targetMinGlucose" value="${user.preferences.targetGlucose.min}" min="60" max="150">
                </div>
                
                <div class="form-group">
                  <label for="targetMaxGlucose">ëª©í‘œ í˜ˆë‹¹ ìµœëŒ€ê°’ (mg/dL)</label>
                  <input type="number" id="targetMaxGlucose" value="${user.preferences.targetGlucose.max}" min="120" max="250">
                </div>
                
                <div class="form-group">
                  <label for="targetA1C">ëª©í‘œ HbA1c (%)</label>
                  <input type="number" id="targetA1C" value="${user.preferences.targetA1C}" step="0.1" min="5.0" max="10.0">
                </div>
                
                <div class="form-group">
                  <label for="insulinType">ì¸ìŠë¦° ì¢…ë¥˜</label>
                  <select id="insulinType">
                    <option value="rapid" ${user.preferences.insulinType === 'rapid' ? 'selected' : ''}>ì´ˆì†íš¨ì„±</option>
                    <option value="short" ${user.preferences.insulinType === 'short' ? 'selected' : ''}>ì†íš¨ì„±</option>
                    <option value="intermediate" ${user.preferences.insulinType === 'intermediate' ? 'selected' : ''}>ì¤‘ê°„í˜•</option>
                    <option value="long" ${user.preferences.insulinType === 'long' ? 'selected' : ''}>ì§€ì†í˜•</option>
                  </select>
                </div>
              </div>
              
              <button onclick="updatePreferences()" class="btn btn-success btn-full">
                ğŸ¯ ëª©í‘œ ì„¤ì • ì €ì¥
              </button>
            </div>
          </div>
          
          <div class="card">
            <h3>ğŸ“Š ë°ì´í„° ê´€ë¦¬</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
              <div style="text-align: center; padding: 1rem; background: rgba(59, 130, 246, 0.1); border-radius: 0.75rem;">
                <div style="font-size: 1.5rem; font-weight: bold; color: #1d4ed8;">${user.personalizedData.totalRecords}</div>
                <div style="color: #1e40af;">í˜ˆë‹¹ ê¸°ë¡</div>
              </div>
              
              <div style="text-align: center; padding: 1rem; background: rgba(245, 158, 11, 0.1); border-radius: 0.75rem;">
                <div style="font-size: 1.5rem; font-weight: bold; color: #d97706;">${user.personalizedData.totalExerciseRecords || 0}</div>
                <div style="color: #92400e;">ìš´ë™ ê¸°ë¡</div>
              </div>
              
              <div style="text-align: center; padding: 1rem; background: rgba(16, 185, 129, 0.1); border-radius: 0.75rem;">
                <div style="font-size: 1.5rem; font-weight: bold; color: #059669;">${Math.round((Date.now() - new Date(user.createdAt)) / (1000 * 60 * 60 * 24))}ì¼</div>
                <div style="color: #047857;">ì‚¬ìš© ê¸°ê°„</div>
              </div>
            </div>
            
            <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
              <button onclick="exportData()" class="btn btn-primary">
                ğŸ“¤ ë°ì´í„° ë‚´ë³´ë‚´ê¸°
              </button>
              <button onclick="importData()" class="btn btn-success">
                ğŸ“¥ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
              </button>
            </div>
            
            <div style="background: rgba(239, 68, 68, 0.1); border: 1px solid #ef4444; border-radius: 0.75rem; padding: 1rem;">
              <h4 style="color: #dc2626; margin-bottom: 0.5rem;">âš ï¸ ìœ„í—˜ êµ¬ì—­</h4>
              <p style="font-size: 0.875rem; color: #991b1b; margin-bottom: 1rem;">
                ì•„ë˜ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì‹ ì¤‘í•˜ê²Œ ê²°ì •í•˜ì„¸ìš”.
              </p>
              <button onclick="deleteAllData()" class="btn btn-danger">
                ğŸ—‘ï¸ ëª¨ë“  ë°ì´í„° ì‚­ì œ
              </button>
            </div>
          </div>
        </div>
      `;
    }

    function updateProfile() {
      const name = document.getElementById('profileName').value;
      const age = document.getElementById('profileAge').value;
      const weight = document.getElementById('profileWeight').value;
      const height = document.getElementById('profileHeight').value;
      const emergency = document.getElementById('profileEmergency').value;
      
      if (!name) {
        alert('ì´ë¦„ì€ í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.');
        return;
      }
      
      userManager.updateUserData({
        name: name,
        age: age ? parseInt(age) : null,
        weight: weight ? parseFloat(weight) : null,
        height: height ? parseInt(height) : null,
        emergencyContact: emergency || null
      });
      
      alert('ê¸°ë³¸ ì •ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
      renderMainApp();
    }

    function updatePreferences() {
      const minGlucose = document.getElementById('targetMinGlucose').value;
      const maxGlucose = document.getElementById('targetMaxGlucose').value;
      const targetA1C = document.getElementById('targetA1C').value;
      const insulinType = document.getElementById('insulinType').value;
      
      userManager.updateUserData({
        preferences: {
          ...userManager.currentUser.preferences,
          targetGlucose: {
            min: parseInt(minGlucose),
            max: parseInt(maxGlucose)
          },
          targetA1C: parseFloat(targetA1C),
          insulinType: insulinType
        }
      });
      
      alert('ëª©í‘œ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
    }

    function exportData() {
      const user = userManager.getCurrentUser();
      const data = {
        userData: user,
        exportDate: new Date().toISOString(),
        appVersion: 'DiaLife Pro v1.0'
      };
      
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `dialife_data_${user.name}_${new Date().toISOString().split('T')[0]}.json`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      alert('ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ë‚´ë³´ë‚´ì¡ŒìŠµë‹ˆë‹¤!');
    }

    function importData() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = '.json';
      input.onchange = (e) => {
        const file = e.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = (e) => {
          try {
            const data = JSON.parse(e.target.result);
            if (data.userData && data.userData.id) {
              if (confirm('ê¸°ì¡´ ë°ì´í„°ë¥¼ ë®ì–´ì“°ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                userManager.users[data.userData.id] = data.userData;
                userManager.currentUser = data.userData;
                userManager.saveUsers();
                alert('ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì™€ì¡ŒìŠµë‹ˆë‹¤!');
                renderMainApp();
              }
            } else {
              alert('ì˜¬ë°”ë¥´ì§€ ì•Šì€ ë°ì´í„° í˜•ì‹ì…ë‹ˆë‹¤.');
            }
          } catch (error) {
            alert('íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
          }
        };
        reader.readAsText(file);
      };
      input.click();
    }

    function deleteAllData() {
      if (confirm('ì •ë§ë¡œ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìœ¼ë©°, ëª¨ë“  í˜ˆë‹¹ ê¸°ë¡, ìš´ë™ ê¸°ë¡, ê°œì¸í™” ë°ì´í„°ê°€ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤.')) {
        if (confirm('ë§ˆì§€ë§‰ í™•ì¸ì…ë‹ˆë‹¤. ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
          userManager.currentUser.records = [];
          userManager.currentUser.exerciseRecords = [];
          userManager.currentUser.personalizedData = {
            totalRecords: 0,
            totalExerciseRecords: 0,
            avgGlucose: 0,
            timeInRange: 0,
            avgA1C: 0,
            personalICR: 15,
            personalISF: 50,
            foodReactions: {},
            exerciseReactions: {},
            timePatterns: {},
            exercisePatterns: {},
            successfulPatterns: [],
            riskFactors: []
          };
          
          userManager.saveUsers();
          alert('ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
          renderMainApp();
        }
      }
    }

    function deleteRecord(recordId) {
      if (confirm('ì´ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        userManager.deleteRecord(recordId);
        renderMainApp();
      }
    }

    function deleteExerciseRecord(recordId) {
      if (confirm('ì´ ìš´ë™ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        userManager.deleteExerciseRecord(recordId);
        renderMainApp();
      }
    }

    // ì•± ì‹œì‘
    document.addEventListener('DOMContentLoaded', initApp);
  </script>
</body>
</html>
